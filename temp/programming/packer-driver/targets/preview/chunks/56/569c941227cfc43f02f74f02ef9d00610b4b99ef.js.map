{"version":3,"sources":["file:///C:/Users/Admin/Downloads/Telegram%20Desktop/FrameworkCocos/FrameworkCocos/assets/vd-framework/ui/VDScreenManager.ts"],"names":["VDEventListener","VDEventListenerName","VDUtils","VDBasePopup","VDBaseScreen","VDControlEvent","ccclass","cc","_decorator","VD_SCREEN_IDS","VD_GUI_TYPE","VD_ANIMATED_TIME","VD_ZINDEX","VD_POPUP_NOTIFY_NAME","VDScreenManager","Component","assetBundle","resources","_canvas","_canvasSize","layerBackground","layerScreen","layerPopup","layerEffect","zOrderMax","popupBackground","_showedMaxOrderPopup","_animating","_popUpStack","_screenStack","instance","_instance","director","getScene","getComponentInChildren","screenSize","View","getDesignResolutionSize","isPortrait","designResolutionSize","width","onLoad","find","getComponent","UITransform","contentSize","sys","isBrowser","gameShell","document","getElementById","cvShadow","createLayerGameBackground","isMobile","isNative","_createLayer","SCREEN","POPUP","EFFECT","Z_ORDER_MAX","_createPopupBackground","uiTransform","setContentSize","mask","addComponent","Mask","active","on","REMOVE_BASE_POPUP","removePopup","RESIZE_WINDOW_EVENT","resizeWindowAdapt","viewSize","screen","windowSize","windowWidth","windowHeight","height","windowRatio","designRatio","view","cWidth","Math","floor","cHeight","zIndex","layer","Node","name","node","addChild","anchorPoint","Vec2","setZIndex","getLayer","BACK_GROUND","setupCommon","load","SpriteFrame","error","spriteFrame","sprite","Sprite","log","canvasBorder","getChildByName","changeCanvasBackground","bgrSprite","color","type","sizeMode","trim","Button","onEnable","_registerEvent","onDisable","_unregisterEvent","onDestroy","splice","length","releaseAll","off","EventType","TOUCH_START","_onTouchBegan","TOUCH_MOVE","_onTouchMoved","TOUCH_END","_onTouchEnded","TOUCH_CANCEL","_onTouchCancelled","CLICK","hidePopupOnBackgroundTouchIfNeed","event","reloadGame","curScreenID","curScreen","screenStack","minScaleFactor","min","maxScaleFactor","max","initWithRootScreen","callback","self","loadScreen","nextScreen","setPosition","push","setOpacity","_screenWillAppear","_screenDidAppear","pushScreen","animated","emit","CanvasCancel","animatedTime","hideCurScreenOnShow","scheduleOnce","_screenWillDisappear","tween","by","position","v3","easing","call","_screenDidDisappear","removeFromParent","start","touchHandler","scale","Vec3","set","popScreen","showWaiting","pop","destroy","parent","y","popToRootScreen","popToScreenAtIndex","getCurrentScreen","hasScreen","classNameOrComponent","i","findScreen","popToScreen","screenIdx","ScreenDidPop","replaceScreenAtIndex","oldScreen","isCurScreen","hasPopUp","def","getCurrentPopup","removePopupNode","popup","localIndex","indexOf","hidePopup","PopupWillDisappear","PopupDidDisappear","uiOpacity","UIOpacity","to","opacity","onUpdate","target","ratio","walk","child","spine","sp","Skeleton","Color","clone","a","nextPopup","showPopupFromPrefabName","resPath","hideWhenTouchOnBackground","showBackgroundLayer","prefab","get","Prefab","showPopupFromPrefab","instantiate","showPopupFromNode","nodePopup","prevPopup","popComp","enabled","PopupWillAppear","PopupDidAppear","comp","hidePopupBackground","showPopupBackground","ScreenWillAppear","ScreenDidAppear","ScreenWillDisappear","ScreenDidDisappear","alignView","setResizeCallback","showEffect","fxNode","animationName","completedCallback","playAnimation","removeChild","children","removeAllEffects","removeAllChildren","setShowedMaxOrderPopup","showed","getShowedMaxOrderPopup"],"mappings":"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","sourcesContent":["import * as cc from 'cc';\nimport { VDEventListener, VDEventListenerName } from '../common/VDEventListener';\nimport VDUtils from '../utils/VDUtils';\nimport VDBasePopup from './VDBasePopup';\nimport VDBaseScreen from './VDBaseScreen';\nimport VDControlEvent from './VDControlEvent';\n\n\nconst { ccclass } = cc._decorator;\nexport enum VD_SCREEN_IDS {\n    LOBBY = 1,\n    MAIN_TABLE = 2\n}\n\nexport enum VD_GUI_TYPE {\n    POPUP = 0,\n    WINDOW = 1,\n    SCREEN = 2\n}\n\nconst VD_ANIMATED_TIME = 0.3;\n\nexport enum VD_ZINDEX {\n    BACK_GROUND = 0,\n    SCREEN = 1,\n    NAVIGATOR = 32,\n    CUSTOM_UI = 64,\n    WINDOW = 128,\n    POPUP = 256,\n    EFFECT = 512,\n    Z_ORDER_MAX = 1024,\n    LOADING = 2048,\n}\n\nconst VD_POPUP_NOTIFY_NAME = 'popup_notify';\n\n@ccclass\nexport default class VDScreenManager extends cc.Component {\n\n    private static _instance: VDScreenManager = null!;\n    public static get instance(): VDScreenManager {\n        if (!VDScreenManager._instance) {\n            VDScreenManager._instance = cc.director.getScene()!.getComponentInChildren(VDScreenManager)!;\n        }\n        return VDScreenManager._instance;\n    }\n\n    // public static set instance(value) {\n    //     VDScreenManager._instance = value;\n    // }\n\n    public assetBundle: cc.AssetManager.Bundle = cc.resources;\n\n    private _canvas: cc.Node = null!;\n    private _canvasSize: cc.Size = null!;\n    get screenSize() {\n        return cc.View.instance.getDesignResolutionSize();\n    }\n    public layerBackground: cc.Node = null!;\n    private layerScreen: cc.Node = null!;\n    private layerPopup: cc.Node = null!;\n    private layerEffect: cc.Node = null!;\n    private zOrderMax: cc.Node = null!;\n    private popupBackground: cc.Node = null!;\n    private _showedMaxOrderPopup: boolean = false;\n\n    isPortrait() {\n        let designResolutionSize = cc.View.instance.getDesignResolutionSize();\n        return (designResolutionSize.width == 720);\n    }\n\n    onLoad() {\n        // cc.log(`onLoad`);\n\n        this._canvas = cc.find('Canvas')!;\n        this._canvasSize = this._canvas.getComponent(cc.UITransform)!.contentSize;\n\n        // VDScreenManager.instance = this._canvas.getComponent(\"VDScreenManager\")! as VDScreenManager;       \n        if (cc.sys.isBrowser) {\n            let gameShell = document.getElementById('game-shell');\n            let cvShadow = document.getElementById('canvas-shadow');\n            if (!gameShell && !cvShadow) {\n                this.createLayerGameBackground();\n            }\n        }\n        else if (cc.sys.isMobile && cc.sys.isNative) {\n            this.createLayerGameBackground();\n        }\n        this.layerScreen = this._createLayer(VD_ZINDEX.SCREEN);\n        this.layerPopup = this._createLayer(VD_ZINDEX.POPUP);\n        this.layerEffect = this._createLayer(VD_ZINDEX.EFFECT);\n        this.zOrderMax = this._createLayer(VD_ZINDEX.Z_ORDER_MAX);\n\n        this._createPopupBackground();\n\n        let uiTransform = this.layerEffect.getComponent(cc.UITransform)!;\n        if (this.isPortrait()) {\n            uiTransform.setContentSize(720, 1560);\n        }\n        else {\n            uiTransform.setContentSize(1560, 720);\n        }\n        let mask = this.layerEffect.addComponent(cc.Mask);\n        this.layerEffect.active = false;\n\n        this.zOrderMax.active = false;\n\n        VDEventListener.on(VDEventListenerName.REMOVE_BASE_POPUP, this.removePopup, this);\n        VDEventListener.on(VDEventListenerName.RESIZE_WINDOW_EVENT, this.resizeWindowAdapt, this);\n    }\n\n    resizeWindowAdapt() {\n        let uiTransform = this.layerScreen.getComponent(cc.UITransform);\n\n        const viewSize = cc.screen.windowSize;\n        let windowWidth = viewSize.width;\n        let windowHeight = viewSize.height;\n        let windowRatio = windowWidth * 1.0 / windowHeight;\n        const designRatio = cc.view.getDesignResolutionSize().width * 1.0 / cc.view.getDesignResolutionSize().height;\n        if (windowRatio > designRatio) {\n            let cWidth = Math.floor(windowRatio * cc.view.getDesignResolutionSize().height);\n            uiTransform.setContentSize(cWidth, cc.view.getDesignResolutionSize().height);\n        }\n        else {\n            let cHeight = Math.floor(cc.view.getDesignResolutionSize().width / windowRatio);\n            uiTransform.setContentSize(cc.view.getDesignResolutionSize().width, cHeight);\n        }\n    }\n\n    private _createLayer(zIndex: number) {\n        let layer = new cc.Node(\"layer_\" + zIndex);\n        layer.name = 'ParentLayer';\n        layer.layer = this.node.layer;\n        this.node.addChild(layer);\n        let uiTransform = layer.addComponent(cc.UITransform);\n        uiTransform.anchorPoint = new cc.Vec2(0.5, 0.5);\n\n        // const viewSize = cc.screen.windowSize;\n        // let width = viewSize.width;\n        // let height = cc.view.getDesignResolutionSize().width / width * viewSize.height;//viewSize.height;\n\n        const viewSize = cc.screen.windowSize;\n        let windowWidth = viewSize.width;\n        let windowHeight = viewSize.height;\n        let windowRatio = windowWidth * 1.0 / windowHeight;\n        const designRatio = cc.view.getDesignResolutionSize().width * 1.0 / cc.view.getDesignResolutionSize().height;\n        if (windowRatio > designRatio) {\n            let cWidth = Math.floor(windowRatio * cc.view.getDesignResolutionSize().height);\n            uiTransform.setContentSize(cWidth, cc.view.getDesignResolutionSize().height);\n        }\n        else {\n            let cHeight = Math.floor(cc.view.getDesignResolutionSize().width / windowRatio);\n            uiTransform.setContentSize(cc.view.getDesignResolutionSize().width, cHeight);\n        }\n\n        layer.setZIndex(zIndex);\n        return layer;\n    }\n\n    public getLayer(zIndex: number) {\n        switch (zIndex) {\n            case VD_ZINDEX.BACK_GROUND:\n                return this.layerBackground;\n\n            case VD_ZINDEX.SCREEN:\n                return this.layerScreen;\n\n            case VD_ZINDEX.POPUP:\n                return this.layerPopup;\n\n            case VD_ZINDEX.EFFECT:\n                return this.layerEffect;\n\n            case VD_ZINDEX.Z_ORDER_MAX:\n                return this.zOrderMax;\n\n            default:\n                return null;\n        }\n    }\n\n    setupCommon() {\n        cc.resources.load(`images/bgr/bg_popup/spriteFrame`, cc.SpriteFrame, (error, spriteFrame) => {\n            // cc.log(`images/bg_popup`);\n            if (spriteFrame) {\n                let sprite = this.popupBackground.getComponent(cc.Sprite)!;\n                sprite.spriteFrame = spriteFrame;\n            }\n            else {\n                cc.log(`load popup background error: ${error}`);\n            }\n        });\n\n        let canvasBorder = this._canvas.getChildByName('canvas_border');\n        if (this.layerBackground) {\n            // only for native app\n            cc.resources.load(`images/bgr/default_sprite_splash/spriteFrame`, cc.SpriteFrame, (error, spriteFrame) => {\n                // cc.log(`images/bg_popup`);\n                if (spriteFrame) {\n                    let sprite = this.layerBackground.getComponent(cc.Sprite)!;\n                    sprite.spriteFrame = spriteFrame;\n                }\n                else {\n                    cc.log(`load popup background error: ${error}`);\n                }\n            });\n            canvasBorder && (canvasBorder.active = true);\n        }\n        else {\n            // for web\n            canvasBorder && (canvasBorder.active = false);\n        }\n    }\n\n    public changeCanvasBackground(bgrSprite: cc.SpriteFrame) {\n        if (bgrSprite && VDScreenManager.instance.layerBackground) {\n            cc.log(`changeCanvasBackground `);\n            let sprite = this.layerBackground.getComponent(cc.Sprite)!;\n            sprite.spriteFrame = bgrSprite;\n            sprite.color = cc.color(255, 255, 255, 255);\n\n            let uiTransform = this.layerBackground.getComponent(cc.UITransform);\n            sprite.getComponent(cc.UITransform).setContentSize(uiTransform.width, uiTransform.height);\n\n            // let windowWidth = cc.screen.windowSize.width;\n            // let windowHeight = cc.screen.windowSize.height;\n\n            // let hAspect = windowHeight / bgrSprite.height;\n            // let wAspect = windowWidth / bgrSprite.width;\n\n            // if (hAspect > wAspect) {\n            //     uiTransform.setContentSize(bgrSprite.width * hAspect, bgrSprite.height * hAspect);\n            // }\n            // else {\n            //     uiTransform.setContentSize(bgrSprite.width * wAspect, bgrSprite.height * wAspect);\n            // }\n        }\n    }\n\n    public createLayerGameBackground() {\n        if (this.layerBackground) return;\n        this.layerBackground = this._createLayer(VD_ZINDEX.BACK_GROUND);\n        let uiTransform = this.layerBackground.getComponent(cc.UITransform);\n\n        let sprite = this.layerBackground.addComponent(cc.Sprite); // transparent background like dark fog\n        sprite.type = 1; // SLICE\n        sprite.color = cc.color(0, 0, 0, 255);\n        sprite.sizeMode = 0;\n        sprite.trim = true;\n\n        const viewSize = cc.screen.windowSize;\n        let windowWidth = viewSize.width;\n        let windowHeight = viewSize.height;\n        let windowRatio = windowWidth * 1.0 / windowHeight;\n\n        const designRatio = cc.view.getDesignResolutionSize().width * 1.0 / cc.view.getDesignResolutionSize().height;\n        if (windowRatio > designRatio) {\n            let cWidth = Math.floor(windowRatio * cc.view.getDesignResolutionSize().height);\n            uiTransform.setContentSize(cWidth, cc.view.getDesignResolutionSize().height);\n            cc.log(`_setupLayerBackground 1: ${cWidth}, ${cc.view.getDesignResolutionSize().height}`);\n        }\n        else {\n            let cHeight = Math.floor(cc.view.getDesignResolutionSize().width / windowRatio);\n            uiTransform.setContentSize(cc.view.getDesignResolutionSize().width, cHeight);\n            cc.log(`_setupLayerBackground 2: ${cc.view.getDesignResolutionSize().width}, ${cHeight}`);\n        }\n    }\n\n    _createPopupBackground() {\n        this.popupBackground = new cc.Node(\"popupBackground\");\n\n        this.layerPopup.addChild(this.popupBackground);\n        this.popupBackground.layer = this.layerPopup.layer;\n        this.popupBackground.active = false;\n\n        let uiTransform = this.popupBackground.addComponent(cc.UITransform);\n        uiTransform.anchorPoint = new cc.Vec2(0.5, 0.5);\n        // uiTransform.contentSize = cc.View.instance.getDesignResolutionSize();\n        if (this.isPortrait()) {\n            uiTransform.setContentSize(720, 1560);\n        }\n        else {\n            uiTransform.setContentSize(1560, 720);\n        }\n        // this.popupBackground.setZIndex(ZINDEX.POPUP);\n\n        let sprite = this.popupBackground.addComponent(cc.Sprite); // transparent background like dark fog\n        sprite.type = 1; // SLICE\n        sprite.color = cc.color(0, 0, 0, 200);\n        sprite.sizeMode = 0;\n        sprite.trim = true;\n\n        this.popupBackground.addComponent(cc.Button);\n    }\n\n    onEnable() {\n        this._registerEvent();\n    }\n\n    onDisable() {\n        this._unregisterEvent();\n    }\n\n    onDestroy() {\n        cc.log(\"[VDScreenManager] onDestroy !\");\n        this._popUpStack.splice(0, this._popUpStack.length);\n        // for (let screen of this._screenStack) {\n        //     if (screen.node.parent) {\n        //         screen.node.removeFromParent();\n        //     }\n        //     screen.destroy();\n        // }\n        this._screenStack.splice(0, this._screenStack.length);\n        this.assetBundle.releaseAll();\n        VDScreenManager._instance = null;\n        VDEventListener.off(VDEventListenerName.REMOVE_BASE_POPUP, this.removePopup, this);\n        VDEventListener.off(VDEventListenerName.RESIZE_WINDOW_EVENT, this.resizeWindowAdapt, this);\n    }\n\n    private _registerEvent() {\n        this.zOrderMax?.on(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this, true);\n        this.zOrderMax?.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMoved, this, true);\n        this.zOrderMax?.on(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this, true);\n        this.zOrderMax?.on(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancelled, this, true);\n\n        this.popupBackground.on(cc.Button.EventType.CLICK, this.hidePopupOnBackgroundTouchIfNeed, this);\n    }\n\n    private _unregisterEvent() {\n        this.zOrderMax?.off(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this, true);\n        this.zOrderMax?.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMoved, this, true);\n        this.zOrderMax?.off(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this, true);\n        this.zOrderMax?.off(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancelled, this, true);\n\n        this.popupBackground.off(cc.Button.EventType.CLICK, this.hidePopupOnBackgroundTouchIfNeed, this);\n    }\n\n    protected _onTouchBegan(event: cc.EventTouch) {\n    }\n\n    protected _onTouchMoved(event: cc.EventTouch) {\n    }\n\n    protected _onTouchEnded(event: cc.EventTouch) {\n    }\n\n    protected _onTouchCancelled(event: cc.EventTouch) {\n    }\n\n    public static reloadGame() {\n        // Canvas.reloadGame(restart);\n    }\n\n    private _animating: boolean = false;\n\n    public get curScreenID(): string | null {\n        let screen = this._screenStack[this._screenStack.length - 1];\n        if (screen)\n            return screen.name;\n        else\n            return null;\n    }\n\n    public get curScreen(): VDBaseScreen {\n        return this._screenStack[this._screenStack.length - 1];\n    }\n\n    private _popUpStack: Array<VDBasePopup> = [];\n\n    public get screenStack(): Array<VDBaseScreen> {\n        return this._screenStack;\n    }\n    private _screenStack: Array<VDBaseScreen> = [];\n\n    // private _screenCached: any = {};\n\n    get minScaleFactor(): number {\n        return Math.min(this.screenSize.width / cc.View.instance.getDesignResolutionSize().width,\n            this.screenSize.height / cc.View.instance.getDesignResolutionSize().height);\n    }\n\n    get maxScaleFactor(): number {\n        return Math.max(this.screenSize.width / cc.View.instance.getDesignResolutionSize().width,\n            this.screenSize.height / cc.View.instance.getDesignResolutionSize().height);\n    }\n\n    initWithRootScreen(screen: cc.Prefab, callback?: Function | null) {\n        if (!screen || this._screenStack.length > 0) {\n            throw \"init root screen failed\";\n        }\n\n        let self = this;\n\n        this.loadScreen(screen, function (nextScreen: VDBaseScreen) {\n            nextScreen.node.setPosition(0, 0);\n            self._screenStack.push(nextScreen);\n\n            nextScreen.node.setZIndex(VD_ZINDEX.SCREEN);\n            nextScreen.node.setOpacity(255);\n\n            self.layerScreen.addChild(nextScreen.node);\n            self._screenWillAppear(nextScreen);\n            self._screenDidAppear(nextScreen);\n            callback && callback(nextScreen);\n        });\n\n    }\n\n    pushScreen(screen: cc.Prefab, callback?: Function | null, animated: boolean = false, zIndex: number = VD_ZINDEX.SCREEN) {\n\n        let self = this;\n        if (this._screenStack.length != 0) {\n            if (this._animating || !screen) return;\n\n            this._canvas.emit(VDControlEvent.CanvasCancel);\n            let animatedTime = animated ? VD_ANIMATED_TIME : 0.0;\n\n            let curScreen = this._screenStack[this._screenStack.length - 1];\n            this.loadScreen(screen, function (nextScreen: VDBaseScreen) {\n\n                if (nextScreen.hideCurScreenOnShow) {\n                    self.scheduleOnce(function () {\n                        self._screenWillDisappear(curScreen);\n                        if (animated) {\n                            cc.tween(curScreen.node)\n                                .by(animatedTime, { position: cc.v3(-self.screenSize.width, 0, 0) }, { easing: 'fade' })\n                                .call(() => {\n                                    self._screenDidDisappear(curScreen, animated);\n                                    curScreen.node.removeFromParent();\n                                })\n                                .start();\n                        } else {\n                            self._screenDidDisappear(curScreen, animated);\n                            curScreen.node.removeFromParent();\n                        }\n                    });\n                }\n\n                let touchHandler = nextScreen.getComponent(cc.Button) as cc.Button;\n                if (!touchHandler) {\n                    touchHandler = nextScreen.addComponent(cc.Button)!;\n                }\n\n                nextScreen.node.setPosition(0, 0);\n                nextScreen.node.setZIndex(zIndex);\n\n                self._screenStack.push(nextScreen);\n                self.scheduleOnce(function () {\n                    self.layerScreen.addChild(nextScreen.node);\n                    self._screenWillAppear(nextScreen, animated);\n\n                    if (animated) {\n                        nextScreen.node.scale = new cc.Vec3(1.0, 1.0, 1.0);\n                        nextScreen.node.setOpacity(255);\n\n                        cc.tween(nextScreen.node)\n                            .set({ position: cc.v3(self.screenSize.width, 0, 0) })\n                            .by(animatedTime, { position: cc.v3(-self.screenSize.width, 0, 0) }, { easing: 'fade' })\n                            .call(() => {\n                                self._screenDidAppear(nextScreen, animated);\n                            })\n                            .start();\n                    } else {\n                        self._screenDidAppear(nextScreen, animated);\n                    }\n                });\n\n                callback && callback(nextScreen);\n            });\n        } else {\n            this.initWithRootScreen(screen, callback);\n        }\n    }\n\n    popScreen(animated: boolean = false, showWaiting: boolean = true): VDBaseScreen | null {\n        if (this._animating || this._screenStack.length <= 1) {\n            return null;\n        }\n\n        let self = this;\n\n        this._canvas.emit(VDControlEvent.CanvasCancel);\n        let animatedTime = animated ? VD_ANIMATED_TIME : 0.0;\n\n        let curScreen = this._screenStack.pop()!;\n        let nextScreen = this._screenStack[this._screenStack.length - 1];\n        nextScreen.node.setPosition(0, 0);\n\n        this.scheduleOnce(function () {\n            self._screenWillDisappear(curScreen, animated);\n            if (animated) {\n                cc.tween(curScreen.node)\n                    .by(animatedTime, { position: cc.v3(self.screenSize.width, 0, 0) }, { easing: 'fade' })\n                    .call(() => {\n                        self._screenDidDisappear(curScreen, animated);\n\n                        curScreen.node.removeFromParent();\n                        curScreen.node.destroy();\n                    })\n                    .start();\n            } else {\n                self._screenDidDisappear(curScreen, animated);\n\n                curScreen.node.removeFromParent();\n                curScreen.destroy();\n            }\n        });\n\n        nextScreen.node.setOpacity(255);\n        nextScreen.node.scale = cc.v3(1.0, 1.0, 1.0);\n        if (!nextScreen.node.parent) {\n            this.scheduleOnce(function () {\n                self.layerScreen.addChild(nextScreen.node);\n                self._screenWillAppear(nextScreen);\n\n                if (animated) {\n                    cc.tween(nextScreen.node)\n                        .set({ position: cc.v3(-self.screenSize.width, nextScreen.node.position.y, 0) })\n                        .by(animatedTime, { position: cc.v3(self.screenSize.width, 0, 0), }, { easing: 'fade' })\n                        .call(() => {\n                            self._screenDidAppear(nextScreen);\n                        })\n                        .start();\n                }\n                else {\n                    self._screenDidAppear(nextScreen);\n                }\n            });\n        }\n        return curScreen;\n    }\n\n    public popToRootScreen(animated: boolean = false) {\n        this.popToScreenAtIndex(0, animated);\n    }\n\n    public getCurrentScreen(): VDBaseScreen | null {\n        if (this._screenStack.length) {\n            return this._screenStack[this._screenStack.length - 1];\n        }\n        return null;\n    }\n\n    public hasScreen(classNameOrComponent: any): boolean {\n        for (let i = this._screenStack.length - 1; 0 <= i; i--) {\n            if (this._screenStack[i].node.getComponent(classNameOrComponent))\n                return true;\n        }\n        return false;\n    }\n\n    public findScreen(classNameOrComponent: any): VDBaseScreen | null {\n        for (let i = this._screenStack.length - 1; i >= 0; i--) {\n            let screen = this._screenStack[i];\n            if (screen.node.getComponent(classNameOrComponent)) {\n                return screen;\n            }\n        }\n        return null;\n    }\n\n    public popToScreen(classNameOrComponent: any, animated: boolean = false): VDBaseScreen | null {\n        let screenIdx = -1;\n        for (let i = this._screenStack.length - 1; i >= 0; i--) {\n            if (this._screenStack[i].node.getComponent(classNameOrComponent)) {\n                screenIdx = i;\n                break;\n            }\n        }\n        return this.popToScreenAtIndex(screenIdx, animated);\n    }\n\n    public popToScreenAtIndex(screenIdx: number, animated: boolean = false, showWaiting: boolean = true): VDBaseScreen | null {\n        if (this._animating || this._screenStack.length <= 1) {\n            return null;\n        }\n        if (screenIdx < 0 || screenIdx > this._screenStack.length - 1) {\n            return null;\n        }\n\n        let self = this;\n\n        this._canvas.emit(VDControlEvent.CanvasCancel);\n        let animatedTime = animated ? VD_ANIMATED_TIME : 0.0;\n\n        let curScreen = this._screenStack.pop()!;\n        let nextScreen = this._screenStack[screenIdx];\n        nextScreen.node.setPosition(0, 0);\n\n        this.scheduleOnce(function () {\n            self._screenWillDisappear(curScreen, animated);\n            if (animated) {\n                cc.tween(curScreen.node)\n                    .by(animatedTime, { position: cc.v3(self.screenSize.width, 0, 0) }, { easing: 'fade' })\n                    .call(() => {\n                        self._screenDidDisappear(curScreen, animated);\n\n                        curScreen.node.removeFromParent();\n                        curScreen.destroy();\n                    })\n                    .start();\n            } else {\n                self._screenDidDisappear(curScreen, animated);\n\n                curScreen.node.removeFromParent();\n                curScreen.destroy();\n            }\n            if (self._screenStack.length > screenIdx + 1) {\n                for (let i = screenIdx + 1; i < self._screenStack.length; i++) {\n                    let screen = self._screenStack[i];\n                    if (screen.node.parent) {\n                        screen.node.emit(VDControlEvent.ScreenDidPop);\n                        screen.node.removeFromParent();\n                        screen.node.destroy();\n                    } else {\n                        screen.node.destroy();\n                    }\n                }\n                self._screenStack.splice(screenIdx + 1, self._screenStack.length - screenIdx - 1);\n            }\n        });\n        nextScreen.node.setOpacity(255);\n        nextScreen.node.scale = cc.v3(1.0, 1.0, 1.0);\n        if (!nextScreen.node.parent) {\n            this.scheduleOnce(function () {\n                self.layerScreen.addChild(nextScreen.node);\n                self._screenWillAppear(nextScreen);\n\n                if (animated) {\n                    cc.tween(nextScreen.node)\n                        .set({ position: cc.v3(-self.screenSize.width, nextScreen.node.position.y, 0) })\n                        .by(animatedTime, { position: cc.v3(self.screenSize.width, 0, 0), }, { easing: 'fade' })\n                        .call(() => {\n                            self._screenDidAppear(nextScreen);\n                        })\n                        .start();\n                }\n                else {\n                    self._screenDidAppear(nextScreen);\n                }\n            });\n        }\n        return curScreen;\n    }\n\n    public replaceScreenAtIndex(screen: cc.Prefab, screenIdx: number, callback?: Function | null, animated: boolean = false, zIndex: number = VD_ZINDEX.SCREEN, showWaiting: boolean = true): VDBaseScreen | null {\n        if (this._animating || this._screenStack.length <= 0) {\n            return null;\n        }\n        if (screenIdx < 0 || screenIdx > this._screenStack.length - 1) {\n            return null;\n        }\n\n        let self = this;\n\n        this._canvas.emit(VDControlEvent.CanvasCancel);\n        let animatedTime = animated ? VD_ANIMATED_TIME : 0.0;\n\n        let oldScreen = this._screenStack[screenIdx];\n        let isCurScreen = (screenIdx == this._screenStack.length - 1);\n\n        this.loadScreen(screen, function (nextScreen: VDBaseScreen) {\n\n            if (nextScreen.hideCurScreenOnShow && isCurScreen) {\n                self.scheduleOnce(function () {\n                    self._screenWillDisappear(oldScreen);\n                    if (animated) {\n                        cc.tween(oldScreen.node)\n                            .by(animatedTime, { position: cc.v3(-self.screenSize.width, 0, 0) }, { easing: 'fade' })\n                            .call(() => {\n                                self._screenDidDisappear(oldScreen, animated);\n                                oldScreen.node.removeFromParent();\n                                oldScreen.destroy();\n                            })\n                            .start();\n                    } else {\n                        self._screenDidDisappear(oldScreen, animated);\n                        oldScreen.node.removeFromParent();\n                        oldScreen.destroy();\n                    }\n                });\n            }\n            else {\n                oldScreen.destroy();\n            }\n\n            let touchHandler = nextScreen.getComponent(cc.Button) as cc.Button;\n            if (!touchHandler) {\n                touchHandler = nextScreen.addComponent(cc.Button)!;\n            }\n\n            nextScreen.node.setPosition(0, 0);\n            nextScreen.node.setZIndex(zIndex);\n            nextScreen.node.scale = new cc.Vec3(1.0, 1.0, 1.0);\n\n            // self._screenStack.push(nextScreen);\n            self._screenStack[screenIdx] = nextScreen;\n\n            if (isCurScreen) {\n                self.scheduleOnce(function () {\n                    self.layerScreen.addChild(nextScreen.node);\n                    self._screenWillAppear(nextScreen, animated);\n\n                    if (animated) {\n                        nextScreen.node.setOpacity(255);\n\n                        cc.tween(nextScreen.node)\n                            .set({ position: cc.v3(self.screenSize.width, 0, 0) })\n                            .by(animatedTime, { position: cc.v3(-self.screenSize.width, 0, 0) }, { easing: 'fade' })\n                            .call(() => {\n                                self._screenDidAppear(nextScreen, animated);\n                            })\n                            .start();\n                    } else {\n                        self._screenDidAppear(nextScreen, animated);\n                    }\n                });\n            }\n            callback && callback(nextScreen);\n        });\n\n        return oldScreen;\n    }\n\n    // preloadCachedScreen(screen: cc.Prefab, callback: Function) {\n    //     let self = this;\n    //     if (!this._screenCached[screen.data.name]) {\n    //         this.loadScreen(screen, function (node: VDBaseScreen) {\n    //             self._screenCached[screen.data.name] = node;\n    //             callback(node);\n    //         }.bind(this));\n    //     } else {\n    //         callback(this._screenCached[screen.data.name]);\n    //     }\n    // }\n\n    public hasPopUp(def: any): boolean {\n        for (let pop of this._popUpStack) {\n            if (pop.node.getComponent(def))\n                return true;\n        }\n        return false;\n\n    }\n\n    getCurrentPopup(): VDBasePopup | null {\n        if (this._popUpStack.length) {\n            return this._popUpStack[this._popUpStack.length - 1];\n        }\n        return null;\n    }\n\n    removePopupNode(node: cc.Node, animated: boolean = true) {\n        if (node.getComponent(VDBasePopup)) {\n            this.removePopup(node.getComponent(VDBasePopup)!, animated);\n        }\n    }\n\n    removePopup(popup: VDBasePopup, animated: boolean = true) {\n        let localIndex = this._popUpStack.indexOf(popup);\n        if (localIndex >= 0) {\n            if (localIndex == this._popUpStack.length - 1) {\n                this.hidePopup(animated);\n            } else {\n                this._popUpStack.splice(localIndex, 1);\n                if (this._popUpStack.length == 0) {\n                    this.popupBackground.active = false;\n                }\n                // this.popupBackground.setZIndex(VD_ZINDEX.POPUP + this._popUpStack.length * 2);\n                popup.node.emit(VDControlEvent.PopupWillDisappear);\n                popup.node.emit(VDControlEvent.PopupDidDisappear);\n                popup.node.removeFromParent();\n                popup.node.destroy();\n            }\n        }\n    }\n\n    hidePopup(animated: boolean = true) {\n        if (this._popUpStack.length > 0) {\n            let popup = this._popUpStack.pop()!;\n            popup.node.emit(VDControlEvent.PopupWillDisappear);\n            if (animated) {\n                popup.node.setOpacity(255);\n                let uiOpacity = popup.node.getComponent(cc.UIOpacity);\n                cc.tween(uiOpacity)\n                    .to(0.25, { opacity: 0 }, {\n                        easing: 'fade',\n                        onUpdate: (target?: object, ratio?: number) => {\n                            popup.node.walk(child => {\n                                let spine: cc.sp.Skeleton = child.getComponent(cc.sp.Skeleton);\n                                if (spine) {\n                                    let color: cc.Color = cc.Color.clone(spine.color);\n                                    color.a = uiOpacity.opacity;\n                                    spine.color = color;\n                                }\n                            });\n                        }\n                    })\n                    .call(() => {\n                        popup.node.emit(VDControlEvent.PopupDidDisappear);\n                        popup.node.removeFromParent();\n                        popup.node.destroy();\n                    })\n                    .start();\n            } else {\n                popup.node.emit(VDControlEvent.PopupDidDisappear);\n                popup.node.removeFromParent();\n                popup.node.destroy();\n            }\n\n            if (this._popUpStack.length > 0) {\n                let nextPopup = this._popUpStack[this._popUpStack.length - 1];\n                if (nextPopup.name === VD_POPUP_NOTIFY_NAME) {\n                    nextPopup.node.setOpacity(255);\n                    nextPopup.node.active = true;\n                    this.popupBackground.setZIndex(VD_ZINDEX.POPUP + this._popUpStack.length * 2);\n                    nextPopup.node.setZIndex(VD_ZINDEX.POPUP + this._popUpStack.length * 2 + 1);\n                }\n            } else {\n                this.popupBackground.setZIndex(VD_ZINDEX.POPUP);\n                this.popupBackground.active = false;\n            }\n        }\n    }\n\n    showPopupFromPrefabName(resPath: string, callback: Function | null = null,\n        hideWhenTouchOnBackground: boolean = true, animated: boolean = true, showBackgroundLayer: boolean = true) {\n\n        if (this._showedMaxOrderPopup) return;\n        let prefab = this.assetBundle.get(resPath, cc.Prefab);\n        if (prefab) {\n            this.showPopupFromPrefab(prefab, callback, hideWhenTouchOnBackground, animated, showBackgroundLayer);\n        } else {\n            this.assetBundle.load(resPath, cc.Prefab, (error, prefab) => {\n                if (prefab) {\n                    this.showPopupFromPrefab(prefab, callback, hideWhenTouchOnBackground, animated, showBackgroundLayer);\n                }\n                else {\n                    cc.log(`showPopupFromPrefabName ERROR: ${error}`);\n                }\n            });\n        }\n    }\n\n    showPopupFromPrefab(prefab: cc.Prefab, callback: Function | null = null,\n        hideWhenTouchOnBackground: boolean = true, animated: boolean = true, showBackgroundLayer: boolean = true) {\n        if (!prefab) {\n            return;\n        }\n\n        let node = cc.instantiate(prefab) as cc.Node;\n        this.showPopupFromNode(node, callback, hideWhenTouchOnBackground, animated, showBackgroundLayer);\n    }\n\n    showPopupFromNode(nodePopup: cc.Node, callback: Function | null = null,\n        hideWhenTouchOnBackground: boolean = true, animated: boolean = true, showBackgroundLayer: boolean = true) {\n        if (!nodePopup) {\n            return;\n        }\n        let self = this;\n\n        if (this._popUpStack.length == 0) {\n            this.popupBackground.active = true;\n        }\n        else {\n            let prevPopup = this._popUpStack[this._popUpStack.length - 1];\n            if (prevPopup.name === VD_POPUP_NOTIFY_NAME && nodePopup.name === VD_POPUP_NOTIFY_NAME) {\n                prevPopup.node.setOpacity(0);\n                prevPopup.node.active = false;\n                // console.log(`VDScreenManager - showPopupFromNode - currentPopup: ${prevPopup.name}`);\n            }\n        }\n        this.popupBackground.setZIndex(VD_ZINDEX.POPUP + this._popUpStack.length * 2);\n\n        // console.log(`VDScreenManager - showPopupFromNode - newPopup: ${nodePopup.name}`);\n        let popComp = nodePopup.getComponent(VDBasePopup) as VDBasePopup;\n        if (!popComp) {\n            popComp = nodePopup.addComponent(VDBasePopup) as VDBasePopup;\n        }\n\n        popComp.hideWhenTouchOnBackground = hideWhenTouchOnBackground;\n\n        this._popUpStack.push(popComp);\n        this.layerPopup.addChild(nodePopup);\n        nodePopup.setZIndex(VD_ZINDEX.POPUP + this._popUpStack.length * 2 + 1);\n\n        if (this.popupBackground.active) {\n            this.popupBackground.getComponent(cc.Sprite)!.enabled = showBackgroundLayer;\n        }\n\n        this.scheduleOnce(function () {\n            self._canvas.emit(VDControlEvent.CanvasCancel);\n        });\n\n        nodePopup.emit(VDControlEvent.PopupWillAppear);\n\n        if (animated) {\n            nodePopup.setOpacity(0);\n            let uiOpacity = nodePopup.getComponent(cc.UIOpacity);\n            cc.tween(uiOpacity)\n                .to(0.25, { opacity: 255 }, { easing: 'fade' })\n                .call(() => {\n                    nodePopup.emit(VDControlEvent.PopupDidAppear);\n                })\n                .start();\n\n        } else {\n            nodePopup.emit(VDControlEvent.PopupDidAppear);\n        }\n\n        callback && callback(popComp);\n\n        return nodePopup;\n    }\n\n    hidePopupOnBackgroundTouchIfNeed() {\n        // cc.log(\"hidePopupOnBackgroundTouchIfNeed\");\n        if (this._popUpStack.length <= 0) return;\n        let comp = this._popUpStack[this._popUpStack.length - 1];\n        if (comp.hideWhenTouchOnBackground) {\n            this.hidePopup();\n        }\n    }\n\n    hidePopupBackground() {\n        this.popupBackground.getComponent(cc.Sprite)!.enabled = false;\n    }\n\n    showPopupBackground() {\n        this.popupBackground.getComponent(cc.Sprite)!.enabled = true;\n    }\n\n    _screenWillAppear(screen: VDBaseScreen, animated?: boolean) {\n        this._animating = true;\n        screen.node.emit(VDControlEvent.ScreenWillAppear, screen);\n    }\n\n    _screenDidAppear(screen: VDBaseScreen, animated?: boolean) {\n        this._animating = false;\n        screen.node.emit(VDControlEvent.ScreenDidAppear, screen);\n    }\n\n    _screenWillDisappear(screen: VDBaseScreen, animated?: boolean) {\n        this._animating = true;\n        screen.node.emit(VDControlEvent.ScreenWillDisappear, screen);\n    }\n\n    _screenDidDisappear(screen: VDBaseScreen, animated?: boolean) {\n        this._animating = false;\n        screen.node.emit(VDControlEvent.ScreenDidDisappear, screen);\n    }\n\n    loadScreen(screen: cc.Prefab, callback: Function) {\n        if (screen) {\n            let node = cc.instantiate(screen);\n            var comp = node.getComponent(VDBaseScreen);\n            if (!comp)\n                comp = node.addComponent(VDBaseScreen);\n            callback && callback(comp);\n        } else\n            callback && callback(null);\n    }\n\n    alignView() {\n        cc.view.setResizeCallback(this.alignView);\n        // cc.Canvas.instance.fitHeight = true;\n        // cc.Canvas.instance.alignWithScreen();\n    }\n\n    showEffect(fxNode: cc.Node, animationName: string = \"\", completedCallback: VoidFunction | null = null) {\n        !this.layerEffect.active && (this.layerEffect.active = true);\n        this.layerEffect.addChild(fxNode);\n        if (animationName.length) {\n            VDUtils.playAnimation(fxNode, animationName, false, () => {\n                // console.log(`showEffect: finished`);\n                completedCallback && completedCallback();\n                this.layerEffect.removeChild(fxNode);\n                fxNode.destroy();\n                (this.layerEffect.children.length == 0) && (this.layerEffect.active = false);\n            });\n        }\n    }\n\n    removeAllEffects() {\n        this.layerEffect.removeAllChildren();\n        this.layerEffect.active = false;\n    }\n\n    setShowedMaxOrderPopup(showed: boolean) {\n        this._showedMaxOrderPopup = showed;\n    }\n\n    getShowedMaxOrderPopup() {\n        return this._showedMaxOrderPopup;\n    }\n}\n"]}