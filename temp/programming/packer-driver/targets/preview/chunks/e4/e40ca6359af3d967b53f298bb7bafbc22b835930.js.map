{"version":3,"sources":["file:///C:/Users/Admin/Downloads/Telegram%20Desktop/FrameworkCocos/FrameworkCocos/assets/vd-framework/ui/VDTabbar.ts"],"names":["VDControlEvent","VDTabbarItem","ccclass","property","cc","_decorator","VDTabbar","Node","CCInteger","Component","_items","_delegate","_curSelectedIndex","items","delegate","value","curSelectedIndex","onLoad","content","tabbar","child","children","active","com","getComponent","t","Button","addComponent","interactable","push","itemIdx","item","node","name","toString","selectItemAtIndex","start","startIndex","valueOf","onEnable","on","Click","onItemClick","onDisable","off","event","target","parseInt","idx","length","tabbarShouldSelectItemAtIndex","unSelItem","setSelected","removeChild","selectedItem","parent","removeFromParent","addChild","widget","Widget","updateAlignment","tabbarSelectedAtIndex","emit","TabbarItemSelected"],"mappings":"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","sourcesContent":["import * as cc from 'cc';\n\nimport VDControlEvent from \"./VDControlEvent\";\nimport VDTabbarItem from './VDTabbarItem';\n\nconst { ccclass, property } = cc._decorator;\n\nexport interface VDTabbarDelegate {\n    tabbarShouldSelectItemAtIndex?(idx: number): boolean;\n    tabbarSelectedAtIndex?(idx: number): void;\n}\n\n@ccclass\nexport default class VDTabbar extends cc.Component {\n\n    @property(cc.Node)\n    tabbar: cc.Node = null!;\n\n    @property(cc.Node)\n    content: cc.Node = null!;\n\n    @property(cc.CCInteger)\n    public startIndex: number = 0;\n\n    private _items: VDTabbarItem[] = [];\n\n    get items(): VDTabbarItem[] {\n        return this._items;\n    }\n\n    private _delegate: VDTabbarDelegate = null!;\n    public get delegate(): VDTabbarDelegate {\n        return this._delegate;\n    }\n\n    public set delegate(value: VDTabbarDelegate) {\n        this._delegate = value;\n    }\n\n    public get curSelectedIndex(): number {\n        return this._curSelectedIndex;\n    }\n    private _curSelectedIndex: number = -1;\n\n    onLoad() {\n        if (!this.content || !this.tabbar) {\n            throw \"tab bar or content view not found\";\n        }\n        for (let child of this.tabbar.children) {\n            if (child.active) {\n                let com = child.getComponent(VDTabbarItem) as VDTabbarItem;\n                if (com) {\n                    let t = child.getComponent(cc.Button);\n                    if (!t) {\n                        t = child.addComponent(cc.Button);\n                    }\n                    t.interactable = true;\n                    this._items.push(com);\n                }\n            }\n        }\n\n        let itemIdx = 0;\n        for (let item of this._items) {\n            item.node.name = itemIdx.toString();\n            itemIdx++;\n        }\n        this.selectItemAtIndex(0);\n    }\n\n    start() {\n        this.selectItemAtIndex(this.startIndex.valueOf())\n    }\n\n    onEnable() {\n        for (let item of this._items) {\n            item.node.on(VDControlEvent.Click, this.onItemClick, this);\n        }\n    }\n\n    onDisable() {\n        for (let item of this._items) {\n            item.node.off(VDControlEvent.Click, this.onItemClick, this);\n        }\n    }\n\n    onItemClick(event: cc.EventTouch) {\n        let node = event.target as cc.Node;\n        this.selectItemAtIndex(parseInt(node.name));\n    }\n\n    selectItemAtIndex(idx: number): boolean {\n        if (!(idx >= 0 && idx <= this._items.length - 1)) {\n            throw \"tab idx not in range\";\n        }\n        if (this._delegate && this._delegate.tabbarShouldSelectItemAtIndex && !this._delegate.tabbarShouldSelectItemAtIndex(idx)) {\n            return false;\n        }\n        if (this._curSelectedIndex != idx) {\n            if (this._curSelectedIndex >= 0 && this._curSelectedIndex <= this._items.length - 1) {\n                let unSelItem = this._items[this._curSelectedIndex];\n                unSelItem.setSelected(false);\n                this.content.removeChild(unSelItem.content);\n            }\n            this._curSelectedIndex = idx;\n            let selectedItem = this._items[idx];\n            selectedItem.setSelected(true);\n            if (selectedItem.content && selectedItem.content.parent) {\n                if (selectedItem.content.parent != this.content) {\n                    selectedItem.content.removeFromParent();\n                    this.content.addChild(selectedItem.content);\n                }\n            } else if (selectedItem.content) {\n                this.content.addChild(selectedItem.content);\n                let widget = selectedItem.content.getComponent(cc.Widget);\n                widget && widget.updateAlignment();\n            }\n            if (this._delegate && this._delegate.tabbarSelectedAtIndex) {\n                this._delegate.tabbarSelectedAtIndex(idx);\n            }\n            this.node.emit(VDControlEvent.TabbarItemSelected, this._curSelectedIndex);\n            return true;\n        }\n        return false;\n    }\n\n\n}\n"]}