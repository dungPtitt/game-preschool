{"version":3,"sources":["file:///C:/Users/Admin/Downloads/Telegram%20Desktop/FrameworkCocos/FrameworkCocos/assets/vd-framework/ui/VDScrollView.ts"],"names":["VDViewGroup","VDScrollContent","VDControlEvent","ccclass","property","type","cc","_decorator","VDScrollDirection","VDScrollView","Enum","CCBoolean","CCFloat","Node","_touchMoved","_touches","_touchMoveDisplacements","_touchMoveTimeDeltas","_touchMovePreviousTimestamp","_autoScroll","_autoScrollStartPosition","v2","_autoScrollPreviousPosition","_autoScrollDeltaPosition","_autoScrollTotalTime","_autoScrollElapsedTime","_autoZoomScale","_autoZoomScaleStartScale","_autoZoomScalePreviousScale","_autoZoomScaleDeltaScale","_autoZoomScaleTotalTime","_autoZoomScaleElapsedTime","_disabledRefObjects","_delegate","_beginContentPosition","_dragging","_dragBeganPosition","_boundaryRect","rect","retainDisabledRef","obj","indexOf","push","releaseDisabledRef","localIndex","splice","autoScroll","autoScrollDeltaPosition","autoScrollStartPosition","delegate","value","beginContentPosition","dragging","dragBeganPosition","onLoad","content","contentComp","getComponent","addComponent","scrollView","onEnable","_recalculateBoundary","_registerEvent","node","on","_reAlignBoundIfNeed","onDisable","cancelTouch","_clearAutoScrollData","_clearAutoZoomScaleData","_unregisterEvent","off","length","quintEaseOut","ratio","t","newContentSize","UITransform","contentSize","width","anchorX","height","anchorY","offsetMinX","minX","getPosition","x","alignMinX","offsetMinY","minY","y","alignMinY","offsetMaxX","maxX","alignMaxX","offsetMaxY","maxY","alignMaxY","_calculateTouchMoveVelocity","totalTime","totalMovement","lastReleaseTimeStamp","fingerNotMoveFlag","i","displacement","timeDelta","add","curTimeStamp","Date","getTime","releaseDeltaTime","multiplyScalar","_gatherTouchMove","delta","shift","timestamp","_calculateAutoScrollTimeByInitialSpeed","initialSpeed","Math","sqrt","_startInertiaScroll","touchMoveVelocity","inertiaTotalMovement","movementFactor","valueOf","_startAttenuatingAutoScroll","deltaMove","initialVelocity","time","startAutoScroll","duration","position","startAutoZoomScale","getScale","scaleTo","scale","animated","setZoomScale","scrollToLeftTop","scrollTo","scrollToLeftBottom","scrollToRightTop","scrollToRightBottom","scrollToTop","scrollToBottom","scrollToLeft","scrollToRight","center","setContentPosition","equals","Vec2","ZERO","scrollToIn","pos","n","scrollAndScaleTo","deltaPos","deltaScale","EPSILON","boundingXReached","boundingYReached","setPosition","update","dt","percentage","min","newScale","reachedEnd","abs","macro","FLT_EPSILON","currentPos","diff","subtract","clone","scrollViewDidScroll","_handlePressLogic","touch","zoomScaleEnabled","_onTouchBegan","event","captureListeners","enabledInHierarchy","_hasNestedViewGroup","touchEnabled","_stopPropagationIfTargetIsMe","_handleMoveLogic","curTouchPosition","getLocation","prevTouchPosition","getPreviousLocation","deltaPosition","oldPosition","newPosition","scrollViewWillBeginDragging","touch1","touch2","curPosTouch1","curPosTouch2","prevPosTouch1","prevPosTouch2","curPosLayer","prevPosLayer","prevScale","dx1","dy1","dx2","dy2","curScale","realCurPosLayer","convertToNodeSpaceAR","v3","deltaX","deltaY","_onTouchMoved","contentPos","target","cancelEvent","EventTouch","getTouches","bubbles","EventType","TOUCH_CANCEL","simulate","BaseNode","dispatchEvent","_handleReleaseLogic","scrollViewWillEndDragging","scrollViewDidEndDragging","removeTouch","_onTouchEnded","_onTouchCancelled","eventPhase","Event","AT_TARGET","propagationStopped","propagationImmediateStopped","CAPTURING_PHASE","item","vg","ViewGroup","isNestedViewGroup","_onMouseWheel","getScrollY","TOUCH_START","TOUCH_MOVE","TOUCH_END","MOUSE_WHEEL","game","Game","EVENT_SHOW","_onShowGame","find","CanvasCancel","max","minScale","maxScale","scrollLockedByRefObjects","scrollViewShouldScroll","scrollEnabled","direction","HORIZONTAL","VERTICAL","BOTH"],"mappings":"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","sourcesContent":["import * as cc from 'cc';\n\nimport VDViewGroup from \"./VDViewGroup\";\nimport VDScrollContent from \"./VDScrollContent\";\nimport VDControlEvent from \"./VDControlEvent\";\n\nconst { ccclass, property, type } = cc._decorator;\n\nexport enum VDScrollDirection {\n    VERTICAL = 1,\n    HORIZONTAL = 2,\n    BOTH = 3\n}\n\nexport interface VDScrollViewDelegate {\n    scrollViewDidScroll?(scrollView: VDScrollView): void;\n    // called on start of dragging (may require some time and or distance to move)\n    scrollViewWillBeginDragging?(scrollView: VDScrollView): void;\n    // called on finger up if the user dragged. velocity is in points/millisecond.\n    scrollViewWillEndDragging?(scrollView: VDScrollView, velocity: cc.Vec2): void;\n    // called on finger up if the user dragged. decelerate is true if it will continue moving afterwards\n    scrollViewDidEndDragging?(scrollView: VDScrollView, decelerate: boolean): void;\n\n    scrollViewChildrenShouldDrag?(scrollView: VDScrollView, event: cc.EventTouch): boolean;\n}\n\nexport interface VDScrollViewDisabledRefObject {\n    scrollViewShouldScroll?(scrollView: VDScrollView): boolean;\n}\n\n@ccclass\nexport default class VDScrollView extends VDViewGroup {\n\n    protected _touchMoved: boolean = false;\n    protected _touches: cc.Touch[] = [];\n\n    // Touch move speed\n    protected _touchMoveDisplacements: Array<cc.Vec2> = [];\n    protected _touchMoveTimeDeltas: Array<number> = [];\n    protected _touchMovePreviousTimestamp: number = 0;\n\n    protected _autoScroll: boolean = false;\n    protected _autoScrollStartPosition: cc.Vec2 = cc.v2(0, 0);// cc.Vec2.ZERO;\n    protected _autoScrollPreviousPosition: cc.Vec2 = cc.v2(0, 0);// cc.Vec2.ZERO;\n    protected _autoScrollDeltaPosition: cc.Vec2 = cc.v2(0, 0);// cc.Vec2.ZERO;\n    protected _autoScrollTotalTime: number = 0;\n    protected _autoScrollElapsedTime: number = 0;\n\n    protected _autoZoomScale: boolean = false;\n    protected _autoZoomScaleStartScale: number = 0;\n    protected _autoZoomScalePreviousScale: number = 0;\n    protected _autoZoomScaleDeltaScale: number = 0;\n    protected _autoZoomScaleTotalTime: number = 0;\n    protected _autoZoomScaleElapsedTime: number = 0;\n\n    private _disabledRefObjects: VDScrollViewDisabledRefObject[] = [];\n\n    public retainDisabledRef(obj: VDScrollViewDisabledRefObject) {\n        if (this._disabledRefObjects.indexOf(obj) < 0) {\n            this._disabledRefObjects.push(obj)\n        }\n    }\n\n    public releaseDisabledRef(obj: VDScrollViewDisabledRefObject) {\n        let localIndex = this._disabledRefObjects.indexOf(obj);\n        if (localIndex >= 0) {\n            this._disabledRefObjects.splice(localIndex, 1);\n        }\n    }\n\n    public get autoScroll(): boolean {\n        return this._autoScroll;\n    }\n\n    public get autoScrollDeltaPosition(): cc.Vec2 {\n        return this._autoScrollDeltaPosition;\n    }\n\n    public get autoScrollStartPosition(): cc.Vec2 {\n        return this._autoScrollStartPosition;\n    }\n\n    public get delegate(): VDScrollViewDelegate {\n        return this._delegate;\n    }\n\n    public set delegate(value: VDScrollViewDelegate) {\n        this._delegate = value;\n    }\n    protected _delegate: VDScrollViewDelegate = null!;\n\n    @property({\n        type: cc.Enum(VDScrollDirection)\n    })\n    direction: VDScrollDirection = VDScrollDirection.BOTH;\n\n    @property(cc.CCBoolean)\n    zoomScaleEnabled: Boolean = false;\n\n    @property(cc.CCFloat)\n    maxScale: Number = 1.0;\n\n    @property(cc.CCFloat)\n    minScale: Number = 1.0;\n\n    @property(cc.Node)\n    content: cc.Node = null!;\n\n    @property(cc.CCBoolean)\n    scrollEnabled: Boolean = true;\n\n    @property(cc.CCBoolean)\n    touchEnabled: Boolean = true;\n\n    @property(cc.CCBoolean)\n    dragChildrenEnabled: Boolean = false;\n\n    @property(cc.CCFloat)\n    protected movementFactor: Number = 0.64;\n\n    // @property(VDScrollBar)\n    // scrollBar: VDScrollBar = null!;\n\n    public get beginContentPosition(): cc.Vec2 {\n        return this._beginContentPosition;\n    }\n\n    protected _beginContentPosition: cc.Vec2 = cc.v2(0, 0);// cc.Vec2.ZERO;\n\n    public get dragging(): boolean {\n        return this._dragging;\n    }\n    protected _dragging: boolean = false;\n    protected _dragBeganPosition: cc.Vec2 = cc.v2(0, 0);// cc.Vec2.ZERO;\n    protected _boundaryRect: cc.Rect = cc.rect(0, 0, 0, 0);\n\n    public get dragBeganPosition(): cc.Vec2 {\n        return this._dragBeganPosition;\n    }\n\n    onLoad() {\n        if (this.content) {\n            let contentComp = this.content.getComponent(VDScrollContent) as VDScrollContent;\n            if (!contentComp) {\n                contentComp = this.content.addComponent(VDScrollContent);\n            }\n            contentComp.scrollView = this;\n        } else {\n            throw \"scroll view must have a content view\";\n        }\n    }\n\n    onEnable() {\n        // if (!cc.CC_EDITOR) {\n        this._recalculateBoundary();\n        this._registerEvent();\n        this.node.on('size-changed', this._reAlignBoundIfNeed, this);\n        if (this.content) {\n            this.content.on('size-changed', this._recalculateBoundary, this, true);\n            this.content.on('scale-changed', this._reAlignBoundIfNeed, this, true);\n        }\n        // }\n    }\n\n    onDisable() {\n        this.cancelTouch();\n        this._clearAutoScrollData();\n        this._clearAutoZoomScaleData();\n        // if (!CC_EDITOR) {\n        this._unregisterEvent();\n        this.node.off('size-changed', this._reAlignBoundIfNeed, this);\n        if (this.content) {\n            this.content.off('size-changed', this._recalculateBoundary, this, true);\n            this.content.off('scale-changed', this._reAlignBoundIfNeed, this, true);\n        }\n        // }\n        // cc.Canvas.instance.node.off(VDControlEvent.TouchRemoved, this.onTouchRemoved, this);\n    }\n\n    private cancelTouch() {\n        this._disabledRefObjects.splice(0, this._disabledRefObjects.length);\n        this._touches.splice(0, this._touches.length);\n    }\n\n    static quintEaseOut(ratio: number): number {\n        let t = ratio - 1;\n        return (t * t * t * t * t + 1);\n    }\n\n    protected _recalculateBoundary() {\n        let newContentSize = this.content.getComponent(cc.UITransform)!.contentSize;\n        this._boundaryRect = cc.rect(newContentSize.width * -this.node.getComponent(cc.UITransform)!.anchorX,\n            newContentSize.height * -this.getComponent(cc.UITransform)!.anchorY,\n            newContentSize.width,\n            newContentSize.height);\n        // cc.log(`[SV] _recalculateBoundary ${newContentSize} - ${this._boundaryRect}`);\n\n        this._reAlignBoundIfNeed();\n    }\n\n    public get offsetMinX(): number {\n        let minX = this.content.getPosition().x - this.content.getComponent(cc.UITransform)!.contentSize.width * this.content.getComponent(cc.UITransform)!.anchorX;\n        let alignMinX = -this.node.getComponent(cc.UITransform)!.width * this.node.getComponent(cc.UITransform)!.anchorX;\n        return minX - alignMinX;\n    }\n\n    public get offsetMinY(): number {\n        let minY = this.content.getPosition().y - this.content.getComponent(cc.UITransform)!.height * this.content.getComponent(cc.UITransform)!.anchorY;\n        let alignMinY = -this.node.getComponent(cc.UITransform)!.height * this.node.getComponent(cc.UITransform)!.anchorY;\n        return minY - alignMinY;\n    }\n\n    public get offsetMaxX(): number {\n        let maxX = this.content.getPosition().x + this.content.getComponent(cc.UITransform)!.width * (1.0 - this.content.getComponent(cc.UITransform)!.anchorX);\n        let alignMaxX = this.node.getComponent(cc.UITransform)!.width * (1.0 - this.node.getComponent(cc.UITransform)!.anchorX);\n        return maxX - alignMaxX;\n    }\n\n    public get offsetMaxY(): number {\n        let maxY = this.content.getPosition().y + this.content.getComponent(cc.UITransform)!.height * (1.0 - this.content.getComponent(cc.UITransform)!.anchorY);\n        let alignMaxY = this.node.getComponent(cc.UITransform)!.height * (1.0 - this.node.getComponent(cc.UITransform)!.anchorY);\n        return maxY - alignMaxY;\n    }\n\n    private _calculateTouchMoveVelocity() {\n        let totalTime = 0;\n        let totalMovement = cc.v2(0, 0);\n        let lastReleaseTimeStamp = this._touchMovePreviousTimestamp;\n        let fingerNotMoveFlag = false;\n        for (let i = this._touchMoveDisplacements.length - 1; i >= 0; i--) {\n            let displacement = this._touchMoveDisplacements[i];\n            let timeDelta = this._touchMoveTimeDeltas[i];\n            if (!fingerNotMoveFlag && displacement.length() < 4) {\n                lastReleaseTimeStamp -= timeDelta / 1000.0;\n                this._touchMoveDisplacements.splice(i, 1);\n                this._touchMoveTimeDeltas.splice(i, 1);\n            } else {\n                fingerNotMoveFlag = true;\n                totalMovement = totalMovement.add(displacement);\n                totalTime += timeDelta;\n            }\n        }\n\n        let curTimeStamp = (new Date()).getTime();\n        let releaseDeltaTime = (curTimeStamp - lastReleaseTimeStamp);\n\n        if (releaseDeltaTime > 64) {\n            return cc.v2(0, 0);\n        }\n\n        if (totalTime > 0) {\n            totalMovement = totalMovement.multiplyScalar(1.0 / totalTime);\n        }\n\n        return totalMovement;\n    }\n\n    protected _gatherTouchMove(delta: cc.Vec2) {\n        while (this._touchMoveDisplacements.length >= 4) {\n            this._touchMoveDisplacements.shift();\n            this._touchMoveTimeDeltas.shift();\n        }\n        this._touchMoveDisplacements.push(delta);\n\n        let timestamp = (new Date()).getTime();\n        this._touchMoveTimeDeltas.push((timestamp - this._touchMovePreviousTimestamp) / 1000.0);\n        this._touchMovePreviousTimestamp = timestamp;\n    }\n\n    protected _calculateAutoScrollTimeByInitialSpeed(initialSpeed: number) {\n        // Calculate the time from the initial speed according to quintic polynomial.\n        return Math.sqrt(Math.sqrt(initialSpeed / 16.0));\n    }\n\n    protected _startInertiaScroll(touchMoveVelocity: cc.Vec2) {\n        let inertiaTotalMovement = touchMoveVelocity.multiplyScalar(this.movementFactor.valueOf());\n        this._startAttenuatingAutoScroll(inertiaTotalMovement, touchMoveVelocity);\n    }\n\n    protected _startAttenuatingAutoScroll(deltaMove: cc.Vec2, initialVelocity: cc.Vec2) {\n        let time = this._calculateAutoScrollTimeByInitialSpeed(initialVelocity.length());\n        this.startAutoScroll(deltaMove, time);\n    }\n\n    public startAutoScroll(delta: cc.Vec2, duration: number) {\n        this._autoScroll = true;\n        this._autoScrollDeltaPosition = delta;\n        this._autoScrollTotalTime = duration;\n        this._autoScrollElapsedTime = 0;\n        this._autoScrollStartPosition = cc.v2(this.content.position.x, this.content.position.y);\n        this._autoScrollPreviousPosition = cc.v2(this.content.position.x, this.content.position.y);\n    }\n\n    public startAutoZoomScale(delta: number, duration: number) {\n        this._autoZoomScale = true;\n        this._autoZoomScaleDeltaScale = delta;\n        this._autoZoomScaleTotalTime = duration;\n        this._autoScrollElapsedTime = 0;\n        this._autoZoomScaleStartScale = this.content.getScale().x;\n    }\n\n    public scaleTo(scale: number, animated: boolean = true): boolean {\n        if (!animated) {\n            return this.setZoomScale(scale);\n        } else {\n            let delta = scale - this.content.getScale().x;\n            if (delta != 0) {\n                this.startAutoZoomScale(delta, 0.5);\n                return true;\n            }\n            return false;\n        }\n    }\n\n    public scrollToLeftTop(animated: boolean = true): boolean {\n        return this.scrollTo(cc.v2(- this.content.getComponent(cc.UITransform)!.anchorX * this.content.getComponent(cc.UITransform)!.width, this.content.getComponent(cc.UITransform)!.height * (1.0 - this.content.getComponent(cc.UITransform)!.anchorY)), animated);\n    }\n\n    public scrollToLeftBottom(animated: boolean = true): boolean {\n        return this.scrollTo(cc.v2(- this.content.getComponent(cc.UITransform)!.anchorX * this.content.getComponent(cc.UITransform)!.width, -this.content.getComponent(cc.UITransform)!.height * this.content.getComponent(cc.UITransform)!.anchorY), animated);\n    }\n\n    public scrollToRightTop(animated: boolean = true): boolean {\n        return this.scrollTo(cc.v2((1.0 - this.content.getComponent(cc.UITransform)!.anchorX) * this.content.getComponent(cc.UITransform)!.width, this.content.getComponent(cc.UITransform)!.height * (1.0 - this.content.getComponent(cc.UITransform)!.anchorY)), animated);\n    }\n\n    public scrollToRightBottom(animated: boolean = true): boolean {\n        return this.scrollTo(cc.v2((1.0 - this.content.getComponent(cc.UITransform)!.anchorX) * this.content.getComponent(cc.UITransform)!.width, -this.content.getComponent(cc.UITransform)!.height * this.content.getComponent(cc.UITransform)!.anchorY), animated);\n    }\n\n    public scrollToTop(animated: boolean = true): boolean {\n        return this.scrollTo(cc.v2((0.5 - this.content.getComponent(cc.UITransform)!.anchorX) * this.content.getComponent(cc.UITransform)!.width, this.content.getComponent(cc.UITransform)!.height * (1.0 - this.content.getComponent(cc.UITransform)!.anchorY)), animated);\n    }\n\n    public scrollToBottom(animated: boolean = true): boolean {\n        return this.scrollTo(cc.v2((0.5 - this.content.getComponent(cc.UITransform)!.anchorX) * this.content.getComponent(cc.UITransform)!.width, -this.content.getComponent(cc.UITransform)!.height * this.content.getComponent(cc.UITransform)!.anchorY), animated);\n    }\n\n    public scrollToLeft(animated: boolean = true): boolean {\n        return this.scrollTo(cc.v2(- this.content.getComponent(cc.UITransform)!.anchorX * this.content.getComponent(cc.UITransform)!.width, (0.5 - this.content.getComponent(cc.UITransform)!.anchorY) * this.content.getComponent(cc.UITransform)!.height), animated);\n    }\n\n    public scrollToRight(animated: boolean = true): boolean {\n        return this.scrollTo(cc.v2((1.0 - this.content.getComponent(cc.UITransform)!.anchorX) * this.content.getComponent(cc.UITransform)!.width, (0.5 - this.content.getComponent(cc.UITransform)!.anchorY) * this.content.getComponent(cc.UITransform)!.height), animated);\n    }\n\n    public scrollTo(center: cc.Vec2, animated: boolean = true): boolean {\n        if (!animated) {\n            return this.setContentPosition(cc.v2(-center.x * this.content.getScale().x, -center.y * this.content.getScale().y), false);\n        } else {\n            let delta = cc.v2(-center.x * this.content.getScale().x - this.content.getPosition().x, -center.y * this.content.getScale().y - this.content.getPosition().y);\n            if (!delta.equals(cc.Vec2.ZERO)) {\n                this.startAutoScroll(delta, 0.5);\n                return true;\n            }\n            return false;\n        }\n    }\n\n    scrollToIn(pos: cc.Vec2, t: number) {\n        if (void 0 === t && (t = .5), t <= 0)\n            return this.setContentPosition(cc.v2(-pos.x * this.content.getScale().x, -pos.y * this.content.getScale().y), false);\n        var n = cc.v2(-pos.x * this.content.getScale().x - this.content.getPosition().x, -pos.y * this.content.getScale().y - this.content.getPosition().y);\n        return !n.equals(cc.Vec2.ZERO) && (this.startAutoScroll(n, t), !0);\n    }\n\n    public scrollAndScaleTo(center: cc.Vec2, scale: number, duration: number = 1.2): boolean {\n        if (duration <= 0) {\n            return this.setContentPosition(cc.v2(-center.x * scale, -center.y * scale)) && this.setZoomScale(scale);\n        } else {\n            let deltaPos = cc.v2(-center.x * scale - this.content.getPosition().x, -center.y * scale - this.content.getPosition().y);\n            let deltaScale = scale - this.content.getScale().x;\n            if (!deltaPos.equals(cc.Vec2.ZERO, cc.EPSILON) || deltaScale != 0) {\n                this.startAutoScroll(deltaPos, duration);\n                this.startAutoZoomScale(deltaScale, duration);\n                return true;\n            }\n            return false;\n        }\n    }\n\n    protected _reAlignBoundIfNeed() {\n        // cc.log(`[SV] _reAlignBoundIfNeed ${this._boundaryRect} - ${this.node.getComponent(cc.UITransform)!.contentSize}`);\n        if (this._boundaryRect.x != 0 || this._boundaryRect.y != 0 || this._boundaryRect.width != 0 || this._boundaryRect.height != 0) {\n\n            let boundingXReached = false;\n            let boundingYReached = false;\n            let maxX = this._boundaryRect.width * this.content.getComponent(cc.UITransform)!.anchorX * this.content.getScale().x\n                - this.node.getComponent(cc.UITransform)!.width * this.node.getComponent(cc.UITransform)!.anchorX;\n            if (this.content.position.x > maxX) {\n                this.content.setPosition(maxX, this.content.position.y);\n                boundingXReached = true;\n            }\n\n            let maxY = this._boundaryRect.height * this.content.getComponent(cc.UITransform)!.anchorY * this.content.getScale().y\n                - this.node.getComponent(cc.UITransform)!.height * this.node.getComponent(cc.UITransform)!.anchorY;\n            if (this.content.position.y > maxY) {\n                this.content.setPosition(this.content.position.x, maxY);\n                boundingYReached = true;\n            }\n\n            // cc.log(`[SV] _reAlignBoundIfNeed 22: ${this.content.getComponent(cc.UITransform)!.anchorX} - ${this.content.getScale().x} - ${this.node.getComponent(cc.UITransform)!.width} - ${this.node.getComponent(cc.UITransform)!.anchorX}`);\n\n            let minX = -(this._boundaryRect.width * (1.0 - this.content.getComponent(cc.UITransform)!.anchorX) * this.content.getScale().x\n                - this.node.getComponent(cc.UITransform)!.width * (1.0 - this.node.getComponent(cc.UITransform)!.anchorX));\n            if (this.content.position.x < minX) {\n                this.content.setPosition(minX, this.content.position.y);\n                boundingXReached = true;\n            }\n\n            let minY = -(this._boundaryRect.height * (1.0 - this.content.getComponent(cc.UITransform)!.anchorY) * this.content.getScale().y\n                - this.node.getComponent(cc.UITransform)!.height * (1.0 - this.node.getComponent(cc.UITransform)!.anchorY));\n            if (this.content.position.y < minY) {\n                // cc.log(`[SV] _reAlignBoundIfNeed 3: ${this.content.getPosition().y}`);\n                this.content.setPosition(this.content.position.x, minY);\n                boundingYReached = true;\n            }\n            // cc.log(`[SV] _reAlignBoundIfNeed 2: ${maxX} - ${maxY} - ${minX} - ${minY}`);\n\n            // if (boundingXReached && boundingYReached) {\n            //     this._autoScroll = false;\n            // }\n        }\n    }\n\n    protected update(dt: number) {\n        if (this._autoZoomScale) {\n            this._autoZoomScaleElapsedTime += dt;\n            let percentage = Math.min(1, this._autoZoomScaleElapsedTime / this._autoZoomScaleTotalTime);\n            percentage = VDScrollView.quintEaseOut(percentage);\n            let newScale = this._autoZoomScaleStartScale + this._autoZoomScaleDeltaScale * percentage;\n            let reachedEnd = Math.abs(percentage - 1) <= cc.macro.FLT_EPSILON;\n            if (reachedEnd) {\n                newScale = this._autoZoomScaleStartScale + this._autoZoomScaleDeltaScale;\n                this._clearAutoZoomScaleData();\n            }\n            this.content.getScale().x = this.content.getScale().y = newScale;\n        }\n\n        if (this._autoScroll) {\n            // cc.log(`[SV] update 2`);\n            this._autoScrollElapsedTime += dt;\n\n            let percentage = Math.min(1, this._autoScrollElapsedTime / this._autoScrollTotalTime);\n            //easing the percent\n            percentage = VDScrollView.quintEaseOut(percentage);\n            let reachedEnd = Math.abs(percentage - 1) <= cc.macro.FLT_EPSILON;\n            // cc.log(`[SV] update 2: ${percentage} - ${this.content.position} - ${this._autoScrollDeltaPosition}- (${this._autoScrollDeltaPosition.x * percentage}, ${this._autoScrollDeltaPosition.y * percentage})`);\n\n            let currentPos = cc.v2(this.content.position.x, this.content.position.y);\n            let diff = currentPos.subtract(this._autoScrollPreviousPosition);\n            this._autoScrollStartPosition = this._autoScrollStartPosition.add(diff);\n\n            // this._autoScrollPreviousPosition = this._autoScrollStartPosition.add2f(this._autoScrollDeltaPosition.x * percentage, this._autoScrollDeltaPosition.y * percentage);\n            this._autoScrollPreviousPosition = cc.Vec2.add(this._autoScrollPreviousPosition, this._autoScrollStartPosition, cc.v2(this._autoScrollDeltaPosition.x * percentage, this._autoScrollDeltaPosition.y * percentage));\n\n            // cc.log(`[SV] update 3: ${this._autoScrollStartPosition} - ${this.content.position} - ${this._autoScrollPreviousPosition}`);\n\n            if (reachedEnd) {\n                this._clearAutoScrollData();\n            }\n            this.setContentPosition(this._autoScrollPreviousPosition.clone());\n        }\n    }\n\n    protected scrollViewDidScroll(scrollView: VDScrollView) {\n        if (this._delegate && this._delegate.scrollViewDidScroll) {\n            this._delegate.scrollViewDidScroll(this);\n        }\n    }\n\n    protected _handlePressLogic(touch: cc.Touch) {\n        this._clearAutoScrollData();\n        this._clearAutoZoomScaleData();\n        if (this.zoomScaleEnabled.valueOf()) {\n            this._touches.push(touch);\n        } else if (this._touches.length == 0) {\n            this._touches.push(touch);\n        }\n    }\n\n    protected _onTouchBegan(event: cc.EventTouch, captureListeners: any[]) {\n        // cc.log(`[Scrollview] _onTouchBegan`);\n        if (!this.enabledInHierarchy!) return;\n        if (this._hasNestedViewGroup(event, captureListeners)) return;\n\n        if (this.touchEnabled.valueOf()) {\n            let touch = event.touch;\n            if (this.content) {\n                this._beginContentPosition = cc.v2(this.content.position.x, this.content.position.y);\n                touch && this._handlePressLogic(touch);\n            }\n        }\n        this._touchMoved = false;\n        this._stopPropagationIfTargetIsMe(event);\n    }\n\n    protected _clearAutoScrollData() {\n        this._autoScroll = false;\n        this._autoScrollStartPosition = cc.v2(0, 0);// cc.Vec2.ZERO;\n        this._autoScrollDeltaPosition = cc.v2(0, 0);// cc.Vec2.ZERO;\n        this._autoScrollTotalTime = 0;\n        this._autoScrollElapsedTime = 0;\n        // Clear gathered touch move information\n        this._touchMovePreviousTimestamp = (new Date()).getTime();\n        this._touchMoveDisplacements.splice(0, this._touchMoveDisplacements.length);\n        this._touchMoveTimeDeltas.splice(0, this._touchMoveTimeDeltas.length);\n    }\n\n    protected _clearAutoZoomScaleData() {\n        this._autoZoomScale = false;\n        this._autoZoomScaleDeltaScale = 0;\n        this._autoZoomScaleElapsedTime = 0;\n        this._autoZoomScaleStartScale = 0;\n        this._autoZoomScaleTotalTime = 0;\n    }\n\n    protected _handleMoveLogic(touch: cc.Touch) {\n        if (this._touches.length == 1) {\n\n            let curTouchPosition = touch.getLocation();\n            let prevTouchPosition = touch.getPreviousLocation();\n            // let startTouchPosition = touch.getStartLocation();\n            let deltaPosition = cc.v2(curTouchPosition.x - prevTouchPosition.x, curTouchPosition.y - prevTouchPosition.y);\n            // let deltaStartPosition = new cc.Vec2(curTouchPosition.x - startTouchPosition.x, curTouchPosition.y - startTouchPosition.y);\n            let oldPosition = new cc.Vec2(this.content.position.x, this.content.position.y);\n            let newPosition = new cc.Vec2(this.content.position.x + deltaPosition.x, this.content.position.y + deltaPosition.y);\n            // cc.log(`[ScrollView] _handleMoveLogic ${curTouchPosition} - ${prevTouchPosition} - ${deltaPosition} - ${oldPosition} - ${newPosition}`);\n            if (this.setContentPosition(newPosition)) {\n                if (!this._dragging) {\n                    this._dragging = true;\n                    this._dragBeganPosition = oldPosition;\n                    if (this._delegate && this._delegate.scrollViewWillBeginDragging) {\n                        this._delegate.scrollViewWillBeginDragging(this);\n                    }\n                }\n            }\n            this._gatherTouchMove(deltaPosition);\n        } else if (this.zoomScaleEnabled.valueOf() && this._touches.length >= 2) {\n            // Get the two first touches\n            let touch1 = this._touches[0];\n            let touch2 = this._touches[1];\n\n            // Get current and previous positions of the touches\n            let curPosTouch1 = touch1.getLocation();\n            let curPosTouch2 = touch2.getLocation();\n            let prevPosTouch1 = touch1.getPreviousLocation();\n            let prevPosTouch2 = touch2.getPreviousLocation();\n\n            // Calculate current and previous positions of the layer relative the anchor point\n            let curPosLayer = cc.v2((curPosTouch1.x + curPosTouch2.x) / 2.0, (curPosTouch1.y + curPosTouch2.y) / 2.0);\n            let prevPosLayer = cc.v2((prevPosTouch1.x + prevPosTouch2.x) / 2.0, (prevPosTouch1.y + prevPosTouch2.y) / 2.0);\n\n            // Calculate new scale\n            let prevScale = this.content.getScale().x;\n\n            let dx1 = curPosTouch2.x - curPosTouch1.x;\n            let dy1 = curPosTouch2.y - curPosTouch1.y;\n\n            let dx2 = prevPosTouch2.x - prevPosTouch1.x;\n            let dy2 = prevPosTouch2.y - prevPosTouch1.y;\n\n            let curScale = this.content.getScale().x * Math.sqrt(dx1 * dx1 + dy1 * dy1) / Math.sqrt(dx2 * dx2 + dy2 * dy2);\n\n            this.setZoomScale(curScale);\n\n            if (this.content.getScale().x != prevScale) {\n                let realCurPosLayer = this.content.getComponent(cc.UITransform)!.convertToNodeSpaceAR(cc.v3(curPosLayer.x, curPosLayer.y, 0));\n                let deltaX = (realCurPosLayer.x) * (this.content.getScale().x - prevScale);\n                let deltaY = (realCurPosLayer.y) * (this.content.getScale().x - prevScale);\n                this.setContentPosition(cc.v2(this.content.getPosition().x - deltaX, this.content.getPosition().y - deltaY));\n            }\n\n            // If current and previous position of the multitouch's center aren't equal . change position of the layer\n            if (!prevPosLayer.equals(curPosLayer)) {\n                this.setContentPosition(cc.v2(this.content.getPosition().x + curPosLayer.x - prevPosLayer.x, this.content.getPosition().y + curPosLayer.y - prevPosLayer.y));\n            }\n        }\n    }\n\n    protected _onTouchMoved(event: cc.EventTouch, captureListeners: any[]) {\n        // cc.log(`[Scrollview] _onTouchMoved`);\n\n        if (!this.enabledInHierarchy!) return;\n        if (this._hasNestedViewGroup(event, captureListeners)) return;\n\n        if (this.touchEnabled.valueOf()) {\n            let touch = event.touch;\n            if (this.content) {\n                touch && this._handleMoveLogic(touch);\n            }\n\n            // // Do not prevent touch events in inner nodes\n            // if (!this.cancelInnerEvents) {\n            //     return;\n            // }\n            let contentPos = cc.v2(this.content.position.x, this.content.position.y);\n            let deltaMove = contentPos.subtract(this._beginContentPosition);\n\n            if (deltaMove.length() > 12) {\n                if (!this._touchMoved && event.target !== this.node) {\n                    // cc.log(`[Scrollview] _onTouchMoved 2`);\n                    // Simulate touch cancel for target node\n                    let cancelEvent = new cc.EventTouch(event.getTouches(), event.bubbles, cc.Node.EventType.TOUCH_CANCEL);\n                    cancelEvent.touch = event.touch;\n                    cancelEvent.simulate = true;\n                    if (event?.target instanceof cc.BaseNode) event?.target?.dispatchEvent(cancelEvent);\n                    this._touchMoved = true;\n                }\n            }\n        }\n        this._stopPropagationIfTargetIsMe(event);\n    }\n\n    protected _handleReleaseLogic(touch: cc.Touch) {\n        let touchMoveVelocity = this._calculateTouchMoveVelocity();\n        if (!touchMoveVelocity.equals(cc.Vec2.ZERO)) {\n            if (this._touches.length == 1) {\n                if (this._dragging) {\n                    if (this._delegate && this._delegate.scrollViewWillEndDragging) {\n                        this._delegate.scrollViewWillEndDragging(this, touchMoveVelocity);\n                    }\n                    this._startInertiaScroll(touchMoveVelocity);\n                    if (this._delegate && this._delegate.scrollViewDidEndDragging) {\n                        this._delegate.scrollViewDidEndDragging(this, true);\n                    }\n                    this._dragging = false;\n                    this._dragBeganPosition = cc.v2(0, 0);// cc.Vec2.ZERO;\n                }\n            } else {\n                this._clearAutoScrollData();\n            }\n        } else {\n            if (this._touches.length == 1) {\n                if (this._dragging) {\n                    if (this._delegate && this._delegate.scrollViewWillEndDragging) {\n                        this._delegate.scrollViewWillEndDragging(this, cc.Vec2.ZERO);\n                    }\n\n                    if (this._delegate && this._delegate.scrollViewDidEndDragging) {\n                        this._delegate.scrollViewDidEndDragging(this, false);\n                    }\n                    this._dragging = false;\n                    this._dragBeganPosition = cc.v2(0, 0);// cc.Vec2.ZERO;\n                }\n            }\n        }\n    }\n\n    private removeTouch(touch: cc.Touch) {\n        // cc.log(`[Scrollview] removeTouch`);\n        let localIndex = this._touches.indexOf(touch);\n        if (localIndex >= 0) {\n            this._touches.splice(localIndex, 1);\n        }\n    }\n\n    protected _onTouchEnded(event: cc.EventTouch, captureListeners: any[]) {\n        // cc.log(`[Scrollview] _onTouchEnded`);\n        if (!this.enabledInHierarchy || this._hasNestedViewGroup(event, captureListeners)) {\n            event.touch && this.removeTouch(event.touch);\n        } else {\n            if (this.touchEnabled.valueOf()) {\n                if (this.content) {\n                    event.touch && this._handleReleaseLogic(event.touch);\n                }\n            }\n            event.touch && this.removeTouch(event.touch);\n            this._stopPropagationIfTargetIsMe(event);\n        }\n    }\n\n    protected _onTouchCancelled(event: cc.EventTouch, captureListeners: any[]) {\n        // cc.log(`[Scrollview] _onTouchCancelled`);\n        if (!this.enabledInHierarchy || this._hasNestedViewGroup(event, captureListeners)) {\n            event.touch && this.removeTouch(event.touch);\n        } else {\n            if (this.touchEnabled.valueOf()) {\n                // Filte touch cancel event send from self\n                if (!event.simulate) {\n                    if (this.content) {\n                        event.touch && this._handleReleaseLogic(event.touch);\n                    }\n                    event.touch && this.removeTouch(event.touch);\n                }\n            }\n            this._stopPropagationIfTargetIsMe(event);\n        }\n    }\n\n    // This is for ui as children of a Button\n    protected _stopPropagationIfTargetIsMe(event: cc.Event) {\n        if (event.eventPhase === cc.Event.AT_TARGET && event.target === this.node) {\n            event.propagationStopped = true;\n            event.propagationImmediateStopped = true;\n        }\n    }\n\n    // this is for nested ui\n    protected _hasNestedViewGroup(event: cc.EventTouch | cc.EventMouse, captureListeners?: any[] | null): boolean {\n        if (event.eventPhase !== cc.Event.CAPTURING_PHASE) return false;\n\n        if (captureListeners) {\n            //captureListeners are arranged from child to parent\n            for (let i = 0; i < captureListeners.length; ++i) {\n                let item = captureListeners[i];\n                if (this.node === item) {\n                    let target = event.target as cc.Node;\n                    let vg = target?.getComponent(cc.ViewGroup) as cc.ViewGroup;\n                    if (vg) {\n                        if (vg instanceof VDViewGroup) {\n                            return vg.isNestedViewGroup(event);\n                        }\n                    }\n                    return vg != null;\n                }\n                let vg = item.getComponent(cc.ViewGroup) as cc.ViewGroup;\n                if (vg) {\n                    if (vg instanceof VDViewGroup) {\n                        return vg.isNestedViewGroup(event);\n                    }\n                }\n                return vg != null;\n            }\n        }\n        return false;\n    }\n\n    protected _onMouseWheel(event: cc.EventMouse, captureListeners: any[]) {\n        // cc.log(`[Scrollview] _onMouseWheel`);\n        if (!this.zoomScaleEnabled) return;\n        if (!this.enabledInHierarchy) return;\n        if (this._hasNestedViewGroup(event, captureListeners)) return;\n\n        if (event.getScrollY() > 0.0) {\n            this.setZoomScale(this.content.getScale().x - 0.1);\n        } else if (event.getScrollY() < 0.0) {\n            this.setZoomScale(this.content.getScale().x + 0.1);\n        }\n        this._stopPropagationIfTargetIsMe(event);\n    }\n\n    protected _registerEvent() {\n        this.node.on(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this, true);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMoved, this, true);\n        this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this, true);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancelled, this, true);\n        this.node.on(cc.Node.EventType.MOUSE_WHEEL, this._onMouseWheel, this, true);\n\n        cc.game.on(cc.Game.EVENT_SHOW, this._onShowGame, this);\n        cc.find('Canvas')?.on(VDControlEvent.CanvasCancel, this._onShowGame, this);\n    }\n\n    protected _unregisterEvent() {\n        this.node.off(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this, true);\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMoved, this, true);\n        this.node.off(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this, true);\n        this.node.off(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancelled, this, true);\n        this.node.off(cc.Node.EventType.MOUSE_WHEEL, this._onMouseWheel, this, true);\n\n        cc.game.off(cc.Game.EVENT_SHOW, this._onShowGame, this);\n        cc.find('Canvas')?.off(VDControlEvent.CanvasCancel, this._onShowGame, this);\n    }\n\n    protected _onShowGame() {\n        this.cancelTouch();\n    }\n\n    setZoomScale(scale: number): boolean {\n        if (this.zoomScaleEnabled.valueOf()) {\n            let newScale = Math.min(Math.max(scale, this.minScale.valueOf()), this.maxScale.valueOf());\n            if (newScale != this.content.getScale().x) {\n                this.content.getScale().x = this.content.getScale().y = newScale;\n                return true;\n            } else {\n                return false;\n            }\n        }\n        return false;\n    }\n\n    private scrollLockedByRefObjects(): boolean {\n        if (this._disabledRefObjects.length > 0) {\n            for (let obj of this._disabledRefObjects) {\n                if (obj.scrollViewShouldScroll && !obj.scrollViewShouldScroll(this)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n\n    setContentPosition(position: cc.Vec2, t: boolean = true) {\n        // cc.log(`[Scrollview] setContentPosition ${position}`);\n        if (!this.scrollEnabled.valueOf())\n            return false;\n        if (this.scrollLockedByRefObjects()) {\n            return false;\n        }\n        if (this.content.position.x != position.x || this.content.position.y != position.y) {\n            let oldPosition = this.content.position.clone();\n            if ((this.direction & VDScrollDirection.HORIZONTAL) != 0) {\n                this.content.setPosition(position.x, this.content.position.y);\n            }\n\n            if ((this.direction & VDScrollDirection.VERTICAL) != 0) {\n                this.content.setPosition(this.content.position.x, position.y);\n            }\n            this._reAlignBoundIfNeed();\n            // cc.log(`[Scrollview] setContentPosition 2: ${oldPosition} - ${this.content.position}`);\n\n            if (!oldPosition.equals(this.content.position)) {\n                // cc.log(`[Scrollview] setContentPosition 3:`);\n                this.scrollViewDidScroll(this);\n                return true;\n            }\n        }\n        return false;\n    }\n}\n"]}