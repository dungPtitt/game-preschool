{"version":3,"sources":["file:///D:/game/FrameworkCocos/assets/vd-games/preschool-exam/script/screens/science/level2_science.ts"],"names":["_decorator","Component","Node","log","Prefab","tween","v3","Label","Graphics","v2","VDScreenManager","level_progress_bar","LocalDataManager","scaleAndHide","ccclass","property","level2_science","type","graphics","canPlay","levelNumber","pStart","pTarget","currentStart","start","startPlay","lev","level","getComponent","string","Number","initGraphic","draw","on","EventType","TOUCH_START","onTouchStart","bind","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","lineWidth","event","pLeft","left","getWorldPosition","x","y","p","getUILocation","out","area","inverseTransformPoint","g","moveTo","lineTo","stroke","dx","Math","abs","dy","drawAgain","clear","onClickInstruction","onClickBack","instance","popToRootScreen","checkAnswer","i","processCorrect","processWrong","ob","getObject","checkDone","science","levelBarUI","handleProgress","setObject","fireWork","active","to","scale","call","showPopupNext","smile","setScale","cry","update","deltaTime","showPopupFromPrefabName","popup","popupWin","finishedCallback","level2_screen","assetBundle","get","String","pushScreen","screen"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, Color, log, Prefab, tween, v3, Label, Vec3, Button, UIOpacity, EventTouch, Graphics, v2, Vec2 } from 'cc';\r\nimport VDBaseScreen from '../../../../../vd-framework/ui/VDBaseScreen';\r\nimport VDScreenManager from '../../../../../vd-framework/ui/VDScreenManager';\r\nimport { ScaleFactor, scaleTo, scaleTo2, TimeFactor } from '../../transiton/Transformation';\r\n\r\nimport { level_progress_bar } from '../../transiton/level_progress_bar';\r\nimport LocalDataManager from '../../common/LocalDataManager';\r\nimport { handleFirework } from '../../common/handleFirework';\r\nimport { scaleAndHide } from '../../transiton/Transformation';\r\nimport VDBasePopup from '../../../../../vd-framework/ui/VDBasePopup';\r\nimport { popup_next } from '../../popups/popup_next';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('level2_science')\r\nexport class level2_science extends Component {\r\n    @property({type: Node})\r\n    draw: Node = null;\r\n    @property({type: Node})\r\n    area: Node = null;\r\n    @property({type: Node})\r\n    listAnswers: Node[] = [];\r\n    @property({type: Node})\r\n    listQuestion: Node[] = [];\r\n    @property({type: Node})\r\n    smile: Node = null;\r\n    @property({type: Node})\r\n    cry: Node = null;\r\n    @property({type: Node})\r\n    fireWork: Node = null;\r\n\r\n    @property({type: Node})\r\n    left: Node = null;\r\n    @property({type: Node})\r\n    right: Node = null;\r\n\r\n    @property(level_progress_bar)\r\n    levelBarUI: level_progress_bar = null;\r\n    @property(Node)\r\n    level: Node = null;\r\n\r\n    private graphics = null;\r\n    private canPlay = true;\r\n    public levelNumber = 1;\r\n    private pStart: Vec2;\r\n    private pTarget: Vec2;\r\n    private currentStart: Vec2;\r\n\r\n    start() {\r\n        this.startPlay();\r\n    }\r\n    startPlay() { \r\n        if(this.canPlay){\r\n            let lev = this.level.getComponent(Label).string;\r\n            this.levelNumber = Number(lev);\r\n            this.initGraphic();\r\n            this.draw.on(Node.EventType.TOUCH_START, this.onTouchStart.bind(this));\r\n            this.draw.on(Node.EventType.TOUCH_MOVE, this.onTouchMove.bind(this));\r\n            this.draw.on(Node.EventType.TOUCH_END, this.onTouchEnd.bind(this));\r\n        }\r\n    }\r\n    initGraphic(){\r\n        this.graphics = this.draw.getComponent(Graphics);\r\n        this.graphics.lineWidth = 10;\r\n    }\r\n    onTouchStart(event: EventTouch){\r\n        // gan vi tri cho nguon\r\n        let pLeft = this.left.getWorldPosition();\r\n        this.pStart = v2(pLeft.x, pLeft.y);\r\n        // gan vi tri bat dau ve\r\n        let p = event.getUILocation();\r\n        this.currentStart = v2(p.x, p.y);\r\n        // xu ly ve\r\n        let out = v3();\r\n        this.area.inverseTransformPoint(out, v3(p.x, p.y, 0));\r\n        let g = this.graphics;\r\n        g.moveTo(out.x, out.y);\r\n    }\r\n    onTouchMove(event: EventTouch){\r\n        let p = event.getUILocation();\r\n        let out = v3();\r\n        this.area.inverseTransformPoint(out, v3(p.x, p.y, 0));\r\n        let g = this.graphics;\r\n        g.lineTo(out.x, out.y);\r\n        g.stroke();\r\n    }\r\n    onTouchEnd(event: EventTouch){\r\n        let p = event.getUILocation();\r\n        log(\"compare: \", this.pStart, this.currentStart);\r\n        let dx = Math.abs(this.pStart.x-this.currentStart.x);\r\n        let dy = Math.abs(this.pStart.y-this.currentStart.y);\r\n        if(dx>40 || dy>40){\r\n            this.drawAgain();\r\n        }else {\r\n            this.currentStart = v2(p.x, p.y);\r\n        }\r\n    }\r\n    drawAgain(){\r\n        this.graphics.clear();\r\n    }\r\n    onClickInstruction() {\r\n        // scaleTo(this.answer, ScaleFactor.BIG_BY_2, ScaleFactor.SMALL_BY_0_5, TimeFactor.MEDIUM, this.toDefault.bind(this));\r\n    }\r\n    onClickBack() {\r\n        VDScreenManager.instance.popToRootScreen();\r\n    } \r\n    checkAnswer(i: number){\r\n        if(this.canPlay){\r\n            if(i==0) {\r\n                this.processCorrect();\r\n            }else {\r\n                this.processWrong();\r\n            }\r\n        }  \r\n    }\r\n    processCorrect(){\r\n        let ob = LocalDataManager.getObject(\"check\", {});\r\n        let checkDone = ob.science[this.levelNumber];\r\n        if(this.levelBarUI){\r\n            if(!checkDone) {\r\n                this.levelBarUI.handleProgress();\r\n            }\r\n            ob.science[this.levelNumber+1] = true;\r\n            LocalDataManager.setObject(\"check\", ob);\r\n        }\r\n        \r\n        this.canPlay = false;\r\n        this.fireWork.active = true;\r\n        // scaleAndHide(this.fireWork, v3(1, 1, 0), 3, this.showPopupNext);\r\n        tween(this.fireWork)\r\n        .to(3, {scale: v3(1, 1, 0)})\r\n        .call(()=>{\r\n            this.showPopupNext();\r\n        })\r\n        .call(()=>{\r\n            this.fireWork.active = false;\r\n        })\r\n        .start();\r\n        this.smile.active = true;\r\n        this.smile.setScale( v3(0.1, 0.1, 0));\r\n        scaleAndHide(this.smile, v3(0.6, 0.6, 0), 2);\r\n        // scaleTo2(this.answer, v3(1.2, 1.2, 0), 2);\r\n        // let sprite =  this.answer.getComponent();\r\n        \r\n        // this.nextBtn.active = true;\r\n    }\r\n    processWrong(){\r\n        this.cry.active = true;\r\n        tween(this.cry)\r\n        .to(1, {scale: v3(0.08, 0.08, 0)})\r\n        .to(0.2, {scale: v3(0, 0, 0)})\r\n        .start();\r\n    }\r\n    update(deltaTime: number) {\r\n        \r\n    }\r\n    // active popup next\r\n    showPopupNext() {\r\n        log(\"check\", this.levelNumber);\r\n        VDScreenManager.instance.showPopupFromPrefabName(\"res/prefabs/popup/popup_next\", (popup: VDBasePopup) => {\r\n            let popupWin = popup as popup_next;\r\n            // dinh nghia finshedCallBack chua goi nó\r\n            popupWin.finishedCallback = () => {\r\n                let level2_screen = VDScreenManager.instance.assetBundle.get('res/prefabs/screen/comparison/level'+String(this.levelNumber+1), Prefab)!;\r\n                VDScreenManager.instance.pushScreen(level2_screen, (screen: VDBaseScreen) => { }, true); \r\n                log(' Just Closed Popup !!!');\r\n            };\r\n            \r\n            \r\n            \r\n        }, false, true, true);\r\n        // if(!this.popupNext) {\r\n            \r\n        // }\r\n        \r\n    }\r\n}\r\n\r\n\r\n"]}