{"version":3,"sources":["file:///D:/game/FrameworkCocos/assets/vd-games/preschool-exam/script/screens/complete_picture/level1_picture.ts"],"names":["_decorator","Component","Node","Prefab","log","tween","v3","Label","VDScreenManager","LocalDataManager","level_progress_bar","ccclass","property","level1_picture","type","canPick","levelNumber","sum","onClickBtnNext","event","data","level2_screen","instance","assetBundle","get","String","pushScreen","screen","onClickBtnBack","popToRootScreen","onClickInstruction","start","lev","level","getComponent","string","Number","startPlay","nextBtn","active","i","itemQuestions","length","on","check_startPositon","bind","p","getWorldPosition","checkPosition","questionP","answerP","answer","dx","Math","abs","x","dy","y","handleCorrect","emit","handleShowPopupNext","fireWork","setScale","to","scale","call","showPopupNext","showPopupFromPrefabName","popup","popupWin","finishedCallback","levelNext_screen","obCheck","getObject","currentLevel","picture","levelBarUI","handleProgress","setObject","handleWrong","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, log, Sprite, tween, v3, Label } from \"cc\";\r\nimport VDBasePopup from \"../../../../../vd-framework/ui/VDBasePopup\";\r\nimport VDBaseScreen from \"../../../../../vd-framework/ui/VDBaseScreen\";\r\nimport VDScreenManager from \"../../../../../vd-framework/ui/VDScreenManager\";\r\nimport LocalDataManager from \"../../common/LocalDataManager\";\r\nimport { popup_next } from \"../../popups/popup_next\";\r\nimport { level_progress_bar } from \"../../transiton/level_progress_bar\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"level1_picture\")\r\nexport class level1_picture extends Component {\r\n  @property({ type: Node })\r\n  itemQuestions: Node[] = [];\r\n  @property({ type: Node })\r\n  // itemAnswers: Node[] = [];\r\n  // @property({type: Node})\r\n  @property(Node)\r\n  answer: Node = null;\r\n  @property(Node)\r\n  nextBtn: Node = null;\r\n  \r\n\r\n  @property(level_progress_bar)\r\n  levelBarUI: level_progress_bar = null;\r\n  @property({type: Node})\r\n  level: Node = null;\r\n  @property({type: Node})\r\n  fireWork: Node = null;\r\n\r\n  private canPick = true;\r\n  private levelNumber = 1;\r\n  private sum = 0;\r\n\r\n  onClickBtnNext(event: TouchEvent, data: any) {\r\n    log(\"check number: \", data);\r\n    let level2_screen = VDScreenManager.instance.assetBundle.get(\r\n      \"res/prefabs/screen/complete_picture/level\" + String(data),\r\n      Prefab\r\n    )!;\r\n    VDScreenManager.instance.pushScreen(\r\n      level2_screen,\r\n      (screen: VDBaseScreen) => {},\r\n      true\r\n    );\r\n  }\r\n  onClickBtnBack() {\r\n    VDScreenManager.instance.popToRootScreen(true);\r\n  }\r\n  onClickInstruction() {\r\n    log(\"start instruction\");\r\n  }\r\n  start() {\r\n    let lev = this.level.getComponent(Label).string;\r\n    this.levelNumber = Number(lev);\r\n    this.startPlay();\r\n  }\r\n\r\n  startPlay() {\r\n    this.nextBtn.active = false;\r\n    if (this.canPick) {\r\n      for (let i = 0; i < this.itemQuestions.length; i++) {\r\n        this.itemQuestions[i].on(\r\n          \"i-am-start\",\r\n          this.check_startPositon.bind(this)\r\n        );\r\n        let p = this.itemQuestions[i].getWorldPosition();\r\n        this.itemQuestions[i].on(\r\n          \"i-am-moving\",\r\n          this.checkPosition.bind(this, i)\r\n        );\r\n      }\r\n    }\r\n  }\r\n  check_startPositon() {\r\n    log(\"check start\");\r\n  }\r\n\r\n  checkPosition(i: number) {\r\n    let questionP = this.itemQuestions[i].getWorldPosition();\r\n    let answerP = this.answer.getWorldPosition();\r\n    \r\n    let dx = Math.abs(answerP.x - questionP.x);\r\n    let dy = Math.abs(answerP.y+50 - questionP.y);\r\n    // log(\"check i: \", dx, dy);\r\n    if (dx < 40 && dy < 40) {\r\n      if (i == 0) {\r\n        this.itemQuestions[i].active = false;\r\n        this.handleCorrect();\r\n      } else {\r\n        this.itemQuestions[i].emit('end-moving');\r\n        log(\"wrong!\");\r\n      }\r\n    }\r\n  }\r\n  handleShowPopupNext(){\r\n    this.fireWork.active = true;\r\n    this.fireWork.setScale(v3(0.1, 0.1, 0));\r\n    tween(this.fireWork)\r\n    .to(3, {scale: v3(1, 1, 0)})\r\n    .call(()=> {\r\n        this.showPopupNext();\r\n    })\r\n    .call(()=>{\r\n        this.fireWork.active = false;\r\n    })\r\n    .start();\r\n  }\r\nshowPopupNext(){\r\n    log(\"check\", this.levelNumber);\r\n    VDScreenManager.instance.showPopupFromPrefabName(\"res/prefabs/popup/popup_next\", (popup: VDBasePopup) => {\r\n        let popupWin = popup as popup_next;\r\n        // dinh nghia finshedCallBack chua goi nÃ³\r\n        popupWin.finishedCallback = () => {\r\n            let levelNext_screen = VDScreenManager.instance.assetBundle.get('res/prefabs/screen/complete_picture/level'+String(this.levelNumber+1), Prefab)!;\r\n            VDScreenManager.instance.pushScreen(levelNext_screen, (screen: VDBaseScreen) => { }, true); \r\n            log(' Just Closed Popup !!!');\r\n        };\r\n    }, false, true, true);\r\n}\r\n\r\n  handleCorrect() {\r\n    log(\"correct!\");\r\n    //cong kinh nghiem\r\n    \r\n    let obCheck = LocalDataManager.getObject(\"check\", {});\r\n    let currentLevel = obCheck.picture[this.levelNumber];\r\n    if(!currentLevel) {\r\n      this.levelBarUI.handleProgress();\r\n      obCheck.picture[this.levelNumber+1] = true;\r\n      LocalDataManager.setObject(\"check\", obCheck);\r\n    }\r\n    \r\n    this.handleShowPopupNext();\r\n    // this.nextBtn.active = true;\r\n  }\r\n  handleWrong(){\r\n\r\n  }\r\n\r\n  update(deltaTime: number) {}\r\n}\r\n"]}