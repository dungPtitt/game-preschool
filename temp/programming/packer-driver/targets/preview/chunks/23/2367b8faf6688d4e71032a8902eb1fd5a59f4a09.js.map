{"version":3,"sources":["file:///D:/game/FrameworkCocos/assets/vd-games/preschool-exam/script/screens/science/level3_science.ts"],"names":["_decorator","Component","Node","Color","log","Prefab","tween","v3","Label","Button","Graphics","v2","VDScreenManager","level_progress_bar","LocalDataManager","ccclass","property","level3_science","type","graphics","canPlay","levelNumber","listPosSrc","ListPosDestination","pSrc","pTarget","pStart","pDrawStart","pTemp","currentStart","firstOne","isStart","idAnswer","dem","start","startPlay","lev","level","getComponent","string","Number","initGraphic","draw","on","EventType","TOUCH_START","onTouchStart","bind","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","lineWidth","event","i","listAnswers","length","pLeft","getWorldPosition","x","y","listQuestion","pRight","p","getUILocation","out","area","inverseTransformPoint","g","strokeColor","BLACK","moveTo","checkStart","dx","Math","abs","dy","clear","lineTo","stroke","handleDrawAgain","handleDrawContinue","checkAnswer","drawAgain","out1","onClickInstruction","onClickBack","instance","popToRootScreen","RED","p1","splice","onDisable","processCorrect","ob","getObject","checkDone","science","levelBarUI","handleProgress","setObject","fireWork","active","to","scale","call","showPopupNext","processWrong","update","deltaTime","showPopupFromPrefabName","popup","popupWin","finishedCallback","level2_screen","assetBundle","get","String","pushScreen","screen"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, Color, log, Prefab, tween, v3, Label, Vec3, Button, UIOpacity, EventTouch, Graphics, v2, Vec2 } from 'cc';\r\nimport VDBaseScreen from '../../../../../vd-framework/ui/VDBaseScreen';\r\nimport VDScreenManager from '../../../../../vd-framework/ui/VDScreenManager';\r\nimport { ScaleFactor, scaleTo, scaleTo2, TimeFactor } from '../../transiton/Transformation';\r\n\r\nimport { level_progress_bar } from '../../transiton/level_progress_bar';\r\nimport LocalDataManager from '../../common/LocalDataManager';\r\nimport { handleFirework } from '../../common/handleFirework';\r\nimport { scaleAndHide } from '../../transiton/Transformation';\r\nimport VDBasePopup from '../../../../../vd-framework/ui/VDBasePopup';\r\nimport { popup_next } from '../../popups/popup_next';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('level3_science')\r\nexport class level3_science extends Component {\r\n    @property({type: Node})\r\n    draw: Node = null;\r\n    @property({type: Node})\r\n    area: Node = null;\r\n    @property({type: Node})\r\n    listAnswers: Node[] = [];\r\n    @property({type: Node})\r\n    listQuestion: Node[] = [];\r\n    @property({type: Node})\r\n    fireWork: Node = null;\r\n\r\n    @property({type: Node})\r\n    left: Node = null;\r\n    @property({type: Node})\r\n    right: Node = null;\r\n\r\n    @property(level_progress_bar)\r\n    levelBarUI: level_progress_bar = null;\r\n    @property(Node)\r\n    level: Node = null;\r\n\r\n    private graphics = null;\r\n    private canPlay = true;\r\n    public levelNumber = 1;\r\n    private listPosSrc = [];\r\n    private ListPosDestination = [];\r\n\r\n    private pSrc: Vec2;\r\n    private pTarget: Vec2;\r\n    private pStart: Vec2;\r\n    private pDrawStart: Vec2;\r\n    private pTemp: Vec2;\r\n    private currentStart: Vec2;\r\n    private firstOne = true;\r\n    private isStart = false;\r\n    private idAnswer = null;\r\n    private dem=0;\r\n\r\n    start() {\r\n        this.startPlay();\r\n    }\r\n    startPlay() { \r\n        if(this.canPlay){\r\n            let lev = this.level.getComponent(Label).string;\r\n            this.levelNumber = Number(lev);\r\n            this.initGraphic();\r\n           \r\n            this.draw.on(Node.EventType.TOUCH_START, this.onTouchStart.bind(this));\r\n            this.draw.on(Node.EventType.TOUCH_MOVE, this.onTouchMove.bind(this));\r\n            this.draw.on(Node.EventType.TOUCH_END, this.onTouchEnd.bind(this));\r\n        }\r\n    }\r\n    initGraphic(){\r\n        this.graphics = this.draw.getComponent(Graphics);\r\n        this.graphics.lineWidth = 10;\r\n\r\n    }\r\n    onTouchStart(event: EventTouch){\r\n        if(this.firstOne){\r\n            // gan vi tri nguon\r\n            for(let i=0; i<this.listAnswers.length; i++){\r\n                let pLeft = this.listAnswers[i].getWorldPosition();\r\n                this.listPosSrc[i] = v2(pLeft.x, pLeft.y);\r\n            }\r\n            // gan vi tri dich\r\n            for(let i=0; i<this.listQuestion.length; i++){\r\n                let pRight = this.listQuestion[i].getWorldPosition();\r\n                this.ListPosDestination[i] = v2(pRight.x, pRight.y);\r\n            }\r\n            log(\"check first start: \", this.listPosSrc, this.ListPosDestination);\r\n            this.firstOne = false;\r\n        }else {\r\n            if(this.pTemp != null){\r\n                this.pStart = v2(this.pTemp.x, this.pTemp.y);\r\n            }\r\n            \r\n        }\r\n        // gan vi tri bat dau ve\r\n        let p = event.getUILocation();\r\n        this.pDrawStart = v2(p.x, p.y);\r\n        \r\n        // xu ly ve\r\n        \r\n        let out = v3();\r\n        this.area.inverseTransformPoint(out, v3(p.x, p.y, 0));\r\n        let g = this.graphics;\r\n        g.strokeColor = Color.BLACK;\r\n        g.moveTo(out.x, out.y);\r\n    }\r\n    checkStart(){\r\n        for(let i=0; i<this.listPosSrc.length; i++){\r\n            let dx = Math.abs(this.listPosSrc[i].x-this.pDrawStart.x);\r\n            let dy = Math.abs(this.listPosSrc[i].y-this.pDrawStart.y);\r\n            if(dx<50 && dy<50){\r\n                log(\"check start: \", this.listPosSrc[i]);\r\n                this.pStart = this.listPosSrc[i];\r\n                this.idAnswer = i;\r\n                this.isStart = true;\r\n                break;\r\n            }else {\r\n                this.graphics.clear();\r\n                // this.pTemp = this.listPosSrc[0];\r\n                log(\"check start draw again!\");\r\n            }\r\n        }\r\n    }\r\n    onTouchMove(event: EventTouch){\r\n        let p = event.getUILocation();\r\n        let out = v3();\r\n        this.area.inverseTransformPoint(out, v3(p.x, p.y, 0));\r\n        let g = this.graphics;\r\n        g.lineTo(out.x, out.y);\r\n        g.stroke();\r\n    }\r\n    onTouchEnd(event: EventTouch){\r\n        // check xem no bat dau o cau tra loi nao\r\n        if(!this.isStart){\r\n            this.checkStart();\r\n        }\r\n        if(this.idAnswer != null){\r\n            let p = event.getUILocation();\r\n            log(\"check id answer: \", this.idAnswer);\r\n            log(\"compare: \", this.pStart, this.pDrawStart);\r\n            let dx = Math.abs(this.pStart.x-this.pDrawStart.x);\r\n            let dy = Math.abs(this.pStart.y-this.pDrawStart.y);\r\n            if(dx>40 || dy>40){\r\n                log(\"draw again!\")\r\n                this.pTemp = v2(this.pStart.x, this.pStart.y);\r\n                this.handleDrawAgain();\r\n                \r\n            }else {\r\n                log(\"draw continue!\");\r\n                this.pTemp = v2(p.x, p.y);\r\n                this.handleDrawContinue();\r\n                //check answer before draw coninue;\r\n                this.checkAnswer();\r\n            }\r\n        }\r\n        \r\n        \r\n    }\r\n    drawAgain(){\r\n        this.graphics.clear();\r\n        this.idAnswer = null;\r\n    }\r\n    handleDrawAgain(){\r\n\r\n    }\r\n    handleDrawContinue(){\r\n        let g = this.graphics;\r\n        //quy doi ve cung toa do\r\n        let out1 = v3();\r\n        this.area.inverseTransformPoint(out1, v3(this.pDrawStart.x, this.pDrawStart.y, 0));\r\n        // di chuyen ve diem can ve\r\n        g.moveTo(out1.x, out1.y);\r\n        this.area.inverseTransformPoint(out1, v3(this.pStart.x, this.pStart.y, 0));\r\n        // ve den diem can ve\r\n        g.lineTo(out1.x, out1.y);\r\n        g.stroke();\r\n    }\r\n    onClickInstruction() {\r\n        // scaleTo(this.answer, ScaleFactor.BIG_BY_2, ScaleFactor.SMALL_BY_0_5, TimeFactor.MEDIUM, this.toDefault.bind(this));\r\n    }\r\n    onClickBack() {\r\n        VDScreenManager.instance.popToRootScreen();\r\n    } \r\n    checkAnswer(){\r\n        if(this.canPlay){\r\n            // check da noi dung cau tra loi chua\r\n            let p = this.ListPosDestination[this.idAnswer];\r\n            let dx = Math.abs(p.x - this.pTemp.x);\r\n            let dy = Math.abs(p.y - this.pTemp.y);\r\n            if(dx<40 && dy<40) {\r\n                //dat lai trang thai de co chon cau de noi tiep\r\n                this.isStart = false;\r\n                \r\n                // xu ly doi net ve thanh duong thang mau do\r\n                let g = this.graphics;\r\n                g.clear();\r\n                g.strokeColor = Color.RED;\r\n                let out = v3();\r\n                let p1 = this.listPosSrc[this.idAnswer];\r\n                this.area.inverseTransformPoint(out, v3(p1.x, p1.y, 0));\r\n                g.moveTo(out.x, out.y);\r\n                p1 = this.ListPosDestination[this.idAnswer];\r\n                this.area.inverseTransformPoint(out, v3(p1.x, p1.y, 0));\r\n                g.lineTo(out.x, out.y);\r\n                g.stroke();\r\n                //\r\n                this.listPosSrc.splice(this.idAnswer,1);\r\n                this.ListPosDestination.splice(this.idAnswer, 1);\r\n                this.listAnswers[this.idAnswer].getComponent(Button).onDisable();\r\n                log(\"correct!\", this.listPosSrc);\r\n                //\r\n                this.processCorrect();\r\n            }\r\n        }\r\n    }\r\n    processCorrect(){\r\n        this.idAnswer = null;\r\n        this.dem++;\r\n        log(\"check dem\", this.dem);\r\n        if(this.dem==this.listQuestion.length){\r\n\r\n            this.canPlay = false;\r\n            let ob = LocalDataManager.getObject(\"check\", {});\r\n            let checkDone = ob.science[this.levelNumber];\r\n            if(this.levelBarUI){\r\n                if(!checkDone) {\r\n                    this.levelBarUI.handleProgress();\r\n                }\r\n                ob.science[this.levelNumber+1] = true;\r\n                LocalDataManager.setObject(\"check\", ob);\r\n            }\r\n\r\n            this.fireWork.active = true;\r\n            tween(this.fireWork)\r\n            .to(3, {scale: v3(1, 1, 0)})\r\n            .call(()=>{\r\n                this.showPopupNext();\r\n            })\r\n            .call(()=>{\r\n                this.fireWork.active = false;\r\n            })\r\n            .start();\r\n        }\r\n        this.fireWork.active = true;\r\n        tween(this.fireWork)\r\n        .to(3, {scale: v3(1, 1, 0)})\r\n        .call(()=>{\r\n            this.fireWork.active = false;\r\n        })\r\n        .start();\r\n        // this.smile.active = true;\r\n        // this.smile.setScale( v3(0.1, 0.1, 0));\r\n        // scaleAndHide(this.smile, v3(0.6, 0.6, 0), 2);\r\n    }\r\n    processWrong(){\r\n        // this.cry.active = true;\r\n        // tween(this.cry)\r\n        // .to(1, {scale: v3(0.08, 0.08, 0)})\r\n        // .to(0.2, {scale: v3(0, 0, 0)})\r\n        // .start();\r\n    }\r\n    update(deltaTime: number) {\r\n        \r\n    }\r\n    // active popup next\r\n    showPopupNext() {\r\n        log(\"check\", this.levelNumber);\r\n        VDScreenManager.instance.showPopupFromPrefabName(\"res/prefabs/popup/popup_next\", (popup: VDBasePopup) => {\r\n            let popupWin = popup as popup_next;\r\n            // dinh nghia finshedCallBack chua goi nÃ³\r\n            popupWin.finishedCallback = () => {\r\n                let level2_screen = VDScreenManager.instance.assetBundle.get('res/prefabs/screen/science/level'+String(this.levelNumber+1), Prefab)!;\r\n                VDScreenManager.instance.pushScreen(level2_screen, (screen: VDBaseScreen) => { }, true); \r\n                log(' Just Closed Popup !!!');\r\n            };\r\n        }, false, true, true);\r\n    }\r\n}\r\n\r\n\r\n"]}