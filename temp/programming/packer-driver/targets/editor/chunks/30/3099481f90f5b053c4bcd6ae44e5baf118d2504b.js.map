{"version":3,"sources":["file:///C:/Users/Admin/Downloads/Telegram%20Desktop/FrameworkCocos/FrameworkCocos/assets/vd-framework/ui/VDBasePopup.ts"],"names":["VDEventListener","VDEventListenerName","VDViewGroup","ccclass","property","cc","_decorator","VDBasePopup","_touchMoved","_hideWhenTouchOnBackground","hideWhenTouchOnBackground","value","_hasNestedViewGroup","event","captureListeners","eventPhase","Event","CAPTURING_PHASE","i","length","item","node","target","vg","getComponent","ViewGroup","isNestedViewGroup","onEnable","draggable","on","Node","EventType","TOUCH_START","_onTouchBegan","TOUCH_MOVE","_onTouchMoved","TOUCH_END","_onTouchEnded","TOUCH_CANCEL","_onTouchCancelled","onDisable","off","_stopPropagationIfTargetIsMe","AT_TARGET","propagationStopped","propagationImmediateStopped","enabledInHierarchy","stopPropagation","distance","touch","getDelta","position","add","Vec3","x","y","n","getLocation","subtract","getStartLocation","e","EventTouch","getTouches","bubbles","simulate","dispatchEvent","hide","REMOVE_BASE_POPUP","popupWillAppear","popupDidAppear","popupWillDisappear","popupDidDisappear","onUITouchEvent","button"],"mappings":"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","sourcesContent":["import * as cc from 'cc';\nimport { VDEventListener, VDEventListenerName } from '../common/VDEventListener';\nimport VDViewGroup from './VDViewGroup';\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class VDBasePopup extends VDViewGroup {\n\n    @property\n    draggable: boolean = false;\n\n    protected _touchMoved: boolean = false;\n\n    public get hideWhenTouchOnBackground(): boolean {\n        return this._hideWhenTouchOnBackground;\n    }\n\n    public set hideWhenTouchOnBackground(value: boolean) {\n        this._hideWhenTouchOnBackground = value;\n    }\n    private _hideWhenTouchOnBackground: boolean = true;\n\n    protected _hasNestedViewGroup(event: cc.EventTouch, captureListeners?: any[] | null): boolean {\n        if (event.eventPhase !== cc.Event.CAPTURING_PHASE) return false;\n\n        if (captureListeners) {\n            //captureListeners are arranged from child to parent\n            for (let i = 0; i < captureListeners.length; ++i) {\n                let item = captureListeners[i];\n                if (this.node === item) {\n                    let target = event.target as cc.Node;\n                    let vg = target?.getComponent(cc.ViewGroup) as cc.ViewGroup;\n                    if (vg) {\n                        if (vg instanceof VDViewGroup) {\n                            return vg.isNestedViewGroup(event);\n                        }\n                    }\n                    return vg != null;\n                }\n                let vg = item.getComponent(cc.ViewGroup) as cc.ViewGroup;\n                if (vg) {\n                    if (vg instanceof VDViewGroup) {\n                        return vg.isNestedViewGroup(event);\n                    }\n                }\n                return vg != null;\n            }\n        }\n        return false;\n    }\n\n    onEnable() {\n        if (this.draggable) {\n            this.node.on(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this, true);\n            this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMoved, this, true);\n            this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this, true);\n            this.node.on(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancelled, this, true);\n        }\n        else {\n            this.node.on(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this);\n        }\n    }\n\n    onDisable() {\n        if (this.draggable) {\n            this.node.off(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this, true);\n            this.node.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMoved, this, true);\n            this.node.off(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this, true);\n            this.node.off(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancelled, this, true);\n        }\n        else {\n            this.node.off(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this);\n        }\n    }\n\n    _stopPropagationIfTargetIsMe(event: cc.EventTouch) {\n        if (event.eventPhase === cc.Event.AT_TARGET && event.target === this.node) {\n            event.propagationStopped = true;\n            event.propagationImmediateStopped = true;\n        }\n    }\n\n    _onTouchBegan(event: cc.EventTouch) {\n        if (!this.enabledInHierarchy!) return;\n        if (this._hasNestedViewGroup(event)) return;\n\n        if (this.draggable) {\n            this._touchMoved = false;\n            this._stopPropagationIfTargetIsMe(event);\n        }\n        else {\n            // event.propagationStopped = true;\n            // event.propagationImmediateStopped = true;\n            event.stopPropagation();\n        }\n    }\n\n    _onTouchMoved(event: cc.EventTouch) {\n        if (!this.enabledInHierarchy!) return;\n        if (this._hasNestedViewGroup(event)) return;\n\n        let distance = event.touch?.getDelta();\n        this.node.position = this.node.position.add(new cc.Vec3(distance?.x, distance?.y, 0));\n        var n = event.getLocation().subtract(event.getStartLocation());\n\n        if (n.length() > 12 && !this._touchMoved && event.target != this.node) {\n            var e = new cc.EventTouch(event.getTouches(), event.bubbles, cc.Node.EventType.TOUCH_CANCEL);\n            // e.type = cc.Node.EventType.TOUCH_CANCEL;\n            e.touch = event.touch;\n            e.simulate = true;\n            (event.target as cc.Node)?.dispatchEvent(e);\n            this._touchMoved = true;\n        }\n    }\n\n    _onTouchEnded(event: cc.EventTouch) {\n        if (!this.enabledInHierarchy!) return;\n        if (this._hasNestedViewGroup(event)) return;\n\n        this._stopPropagationIfTargetIsMe(event);\n    }\n\n    _onTouchCancelled(event: cc.EventTouch) {\n        if (!this.enabledInHierarchy!) return;\n        if (this._hasNestedViewGroup(event)) return;\n\n        this._stopPropagationIfTargetIsMe(event);\n    }\n\n    public hide() {\n        VDEventListener.dispatchEvent(VDEventListenerName.REMOVE_BASE_POPUP, this);\n    }\n\n    popupWillAppear() {\n\n    }\n\n    popupDidAppear() {\n\n    }\n\n    popupWillDisappear() {\n\n    }\n\n    popupDidDisappear() {\n\n    }\n\n    onUITouchEvent(button: any) {\n\n    }\n}\n"]}