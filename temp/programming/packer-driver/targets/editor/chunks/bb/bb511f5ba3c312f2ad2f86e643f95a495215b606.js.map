{"version":3,"sources":["file:///D:/game/FrameworkCocos/assets/vd-games/preschool-exam/script/screens/match/level2_match.ts"],"names":["_decorator","Component","Node","Prefab","log","tween","v3","Label","VDScreenManager","LocalDataManager","level_progress_bar","ccclass","property","level2_match","type","canPick","levelNumber","sum","isTouchAnswers","isTouchQuestions","numberSelect","idItemSelected1","idItemSelected2","onClickBtnNext","event","data","level2_screen","instance","assetBundle","get","String","pushScreen","screen","onClickBtnBack","popToRootScreen","onClickInstruction","start","lev","level","getComponent","string","Number","startPlay","i","listQuestions","length","on","EventType","TOUCH_START","checkSelected1","bind","listAnswers","checkSelected2","checkQuestion","checkAnswer","handleCorrect","obCheck","getObject","currentLevel","match","levelBarUI","handleProgress","setObject","handleShowPopupNext","fireWork","active","setScale","to","scale","call","showPopupNext","showPopupFromPrefabName","popup","popupWin","finishedCallback","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, log, Sprite, tween, v3, Label } from 'cc';\r\nimport VDBasePopup from '../../../../../vd-framework/ui/VDBasePopup';\r\nimport VDBaseScreen from '../../../../../vd-framework/ui/VDBaseScreen';\r\nimport VDScreenManager from '../../../../../vd-framework/ui/VDScreenManager';\r\nimport LocalDataManager from '../../common/LocalDataManager';\r\nimport { popup_next } from '../../popups/popup_next';\r\nimport { level_progress_bar } from '../../transiton/level_progress_bar';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('level2_match')\r\nexport class level2_match extends Component {\r\n\r\n    @property({type: Node})\r\n    listQuestions: Node[] = [];\r\n    @property({type: Node})\r\n    listAnswers: Node[] = [];\r\n    @property(level_progress_bar)\r\n    levelBarUI: level_progress_bar = null;\r\n    @property({type: Node})\r\n    level: Node = null;\r\n    @property({type: Node})\r\n    fireWork: Node = null;\r\n\r\n    private canPick = true;\r\n    private levelNumber = 1;\r\n    private sum = 0;\r\n    isTouchAnswers: Boolean[] = [];\r\n    isTouchQuestions: Boolean[] = [];\r\n    private numberSelect = 0;\r\n    private idItemSelected1 = null;\r\n    private idItemSelected2 = null;\r\n\r\n    onClickBtnNext(event: TouchEvent, data: any) {\r\n        log(\"check number: \", data)\r\n        let level2_screen = VDScreenManager.instance.assetBundle.get('res/prefabs/screen/match/level'+String(data), Prefab)!;\r\n        VDScreenManager.instance.pushScreen(level2_screen, (screen: VDBaseScreen) => { }, true);\r\n        //\r\n    }\r\n    onClickBtnBack() {\r\n        VDScreenManager.instance.popToRootScreen(true);\r\n    }\r\n    onClickInstruction() {\r\n        log(\"start instruction\")\r\n    }\r\n    start() {\r\n        let lev = this.level.getComponent(Label).string;\r\n        this.levelNumber = Number(lev);\r\n        this.startPlay();\r\n    }\r\n\r\n    startPlay(){\r\n        if(this.canPick) {\r\n            for(let i=0; i<this.listQuestions.length; i++){\r\n                this.listQuestions[i].on(Node.EventType.TOUCH_START, this.checkSelected1.bind(this, i));\r\n                this.listAnswers[i].on(Node.EventType.TOUCH_START, this.checkSelected2.bind(this, i));\r\n                this.isTouchAnswers[i] = false;\r\n                this.isTouchQuestions[i] = false;\r\n            }  \r\n        }\r\n    }\r\n    checkSelected1(i: number){\r\n        \r\n        // khong the chon 2 cung mot the loai;\r\n        if(this.idItemSelected1==null){\r\n            this.idItemSelected1 = i;\r\n            this.checkQuestion(i);\r\n        }\r\n    }\r\n    checkSelected2(i: number){\r\n        if(this.idItemSelected2==null){\r\n            this.idItemSelected2 = i;\r\n            this.checkAnswer(i);\r\n        }else{\r\n            // khong the chon 2 cung mot the loai;\r\n        }\r\n        \r\n    }\r\n    checkQuestion(i: number){\r\n        if(!this.isTouchQuestions[i]){\r\n            this.isTouchQuestions[i] = true;\r\n            this.numberSelect++;\r\n            if(this.numberSelect==2 && this.isTouchAnswers[i]){\r\n                log(\"select correct!\");\r\n                this.numberSelect = 0;\r\n                this.sum++;\r\n            }else if(this.numberSelect==2 && !this.isTouchAnswers[i]){\r\n                log(\"seclect wrong!\");\r\n                this.isTouchQuestions[i] = false;\r\n            }\r\n        }else{\r\n            this.isTouchQuestions[i] = false;\r\n        }\r\n    }\r\n    checkAnswer(i: number){\r\n        if(!this.isTouchAnswers[i]){\r\n            this.isTouchAnswers[i] = true;\r\n            this.numberSelect++;\r\n            if(this.numberSelect==2 && this.isTouchQuestions[i]){\r\n                log(\"select correct!\");\r\n                this.numberSelect = 0;\r\n                this.sum++;\r\n            }else if(this.numberSelect==2 && !this.isTouchQuestions[i]){\r\n                this.numberSelect = 0;\r\n                this.isTouchAnswers[i] = false;\r\n                log(\"seclect wrong!\");\r\n            }\r\n        }else{\r\n            this.isTouchAnswers[i] = false;\r\n        }\r\n    }\r\n\r\n    \r\n    // checkPosition(i: number){\r\n    //     let questionP = this.itemQuestions[i].getWorldPosition();\r\n    //     // log(\"check i: \",i);\r\n        \r\n    //     for(let j = 0; j<this.itemAnswers.length; j++){\r\n    //         let answerP = this.itemAnswers[j].getWorldPosition();\r\n    //         let dx = Math.abs(answerP.x-questionP.x);\r\n    //         let dy = Math.abs(answerP.y-questionP.y);\r\n    //         if(dx<40 && dy<40){\r\n    //             if(i==j){\r\n    //                 this.itemQuestions[i].active = false;\r\n    //                 let spriteA = this.itemAnswers[i].getComponent(Sprite);\r\n    //                 let spriteQ = this.itemQuestions[i].getComponent(Sprite);\r\n    //                 spriteA.color = spriteQ.color;\r\n    //                 this.sum++;\r\n    //                 if(this.sum == 3) {\r\n    //                     this.handleCorrect();\r\n    //                 }\r\n    //             }else{\r\n    //                 // xu ly khi keo sai\r\n    //                 log(\"wrong!\")\r\n    //             }\r\n    //         }\r\n    //     }\r\n    // }\r\n\r\n    handleCorrect(){\r\n        log(\"correct!\");\r\n        //cong kinh nghiem\r\n        \r\n        let obCheck = LocalDataManager.getObject(\"check\", {});\r\n        let currentLevel = obCheck.match[this.levelNumber+1];\r\n        if(!currentLevel) {\r\n            this.levelBarUI.handleProgress();\r\n            log(\"check level \", this.levelNumber+1);\r\n        }\r\n        obCheck.match[this.levelNumber+1] = true;\r\n        LocalDataManager.setObject(\"check\", obCheck);\r\n        \r\n        this.handleShowPopupNext();\r\n        // this.nextBtn.active = true;\r\n    }\r\n    handleShowPopupNext(){\r\n        this.fireWork.active = true;\r\n        this.fireWork.setScale(v3(0.1, 0.1, 0));\r\n        tween(this.fireWork)\r\n        .to(3, {scale: v3(1, 1, 0)})\r\n        .call(()=> {\r\n            this.showPopupNext();\r\n        })\r\n        .call(()=>{\r\n            this.fireWork.active = false;\r\n        })\r\n        .start();\r\n    }\r\n    showPopupNext(){\r\n        log(\"check\", this.levelNumber);\r\n        VDScreenManager.instance.showPopupFromPrefabName(\"res/prefabs/popup/popup_next\", (popup: VDBasePopup) => {\r\n            let popupWin = popup as popup_next;\r\n            // dinh nghia finshedCallBack chua goi nó\r\n            popupWin.finishedCallback = () => {\r\n                let level2_screen = VDScreenManager.instance.assetBundle.get('res/prefabs/screen/match/level'+String(this.levelNumber+1), Prefab)!;\r\n                VDScreenManager.instance.pushScreen(level2_screen, (screen: VDBaseScreen) => { }, true); \r\n                log(' Just Closed Popup !!!');\r\n            };\r\n        }, false, true, true);\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        \r\n    }\r\n}\r\n\r\n\r\n"]}