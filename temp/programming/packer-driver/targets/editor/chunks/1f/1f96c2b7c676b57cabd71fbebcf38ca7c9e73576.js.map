{"version":3,"sources":["file:///C:/Users/Admin/Downloads/Telegram%20Desktop/FrameworkCocos/FrameworkCocos/assets/vd-framework/utils/VDUtils.ts"],"names":["VDUtils","tween","Vec3","playAllVfx","rootNode","animName","loop","anim","getComponentInChildren","cc","sp","Skeleton","setAnimation","getAnimationName","spine","trackIndex","curAnimation","getCurrent","animation","name","playAnimation","spineNode","completedCallback","getComponent","entry","setTrackCompleteListener","setMix","anim1","anim2","mixTime","transitionBackgroundWeb","fromBgrName","toBrgName","sys","isBrowser","fromBg","document","getElementById","className","replace","toBg","formatTimestamp","ts","hasYear","d","Date","h","addZero","getHours","m","getMinutes","s","getSeconds","t","getDate","getMonth","getFullYear","i","animateScaleUp","target","scaleUpRate","duration","toRate","startRate","finishedCallback","scale0","scale","scale1","to","easing","scale2","func","call","animate","set","then","start","equalsArray","a","b","length","every","v","shakeEffect","node","strength","stop","backUpPos","getPosition","lstMoveTweens","loopTime","Math","floor","rand_x","x","getRandomFloat","rand_y","y","moveTw","position","push","twShake","sequence","setPosition","min","max","random","shuffleArray","randomIndex","itemIndex","clearArray","splice","cloneArray"],"mappings":"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","sourcesContent":["import * as cc from 'cc';\nimport { tween, Tween, Vec3 } from 'cc';\n\nexport default class VDUtils {\n\n    public static playAllVfx(rootNode: cc.Node, animName: string, loop: boolean = false) {\n        let anim = rootNode.getComponentInChildren(cc.sp.Skeleton);\n        anim?.setAnimation(0, animName, loop);\n    }\n\n    public static getAnimationName(spine: cc.sp.Skeleton, trackIndex: number = 0): string | null {\n        let curAnimation = spine.getCurrent(trackIndex);\n        if (!curAnimation) return null;\n        return curAnimation.animation.name;\n    }\n\n    public static playAnimation(spineNode: cc.Node, name: string, loop: boolean = false, completedCallback: VoidFunction | null = null): boolean {\n        if (!spineNode) return false;\n        let spine = spineNode.getComponent(cc.sp.Skeleton);\n        if (!spine) return false;\n        let entry = spine.setAnimation(0, name, loop);\n        if (!entry) return false;\n        spine.setTrackCompleteListener(entry, () => {\n            completedCallback && completedCallback();\n        });\n        return true;\n    }\n\n    public static setMix(spine: cc.sp.Skeleton, anim1: string, anim2: string, mixTime: number = 0.25) {\n        spine?.setMix(anim1, anim2, mixTime);\n        spine?.setMix(anim2, anim1, mixTime);\n    }\n\n    public static transitionBackgroundWeb(fromBgrName: string, toBrgName: string) {\n        if (cc.sys.isBrowser) {\n            const fromBg = document.getElementById(fromBgrName);\n            fromBg && (fromBg.className = fromBg.className.replace('visible', 'hidden'));\n\n            const toBg = document.getElementById(toBrgName);\n            toBg && (toBg.className = fromBg.className.replace('hidden', 'visible'));\n        }\n    }\n\n    public static formatTimestamp(ts: number | string, hasYear?: boolean) {\n        const d = new Date(ts);\n        const h = VDUtils.addZero(d.getHours());\n        const m = VDUtils.addZero(d.getMinutes());\n        const s = VDUtils.addZero(d.getSeconds());\n        const t = VDUtils.addZero(d.getDate()) + '/' + VDUtils.addZero(d.getMonth() + 1) + (hasYear ? ('/' + d.getFullYear()) : '') + ' ' + h + ':' + m + ':' + s;\n        return t;\n    }\n\n    public static addZero(i: any) {\n        if (i < 10) {\n            i = '0' + i;\n        }\n        return i;\n    }\n\n    /**\n     * target scale will set with `startRate`, then scale to `scaleUpRate` during `duration`, then scale to `toRate` during `duration`, after all call `finishedCallback`\n     */\n    public static animateScaleUp(target: cc.Node, scaleUpRate: number, duration: number = 0.2, toRate: number = 1, startRate: number = 1,\n        finishedCallback: VoidFunction | null = null) {\n        let scale0 = { scale: new Vec3(startRate, startRate, startRate) };\n        let scale1 = tween().to(duration, { scale: new Vec3(scaleUpRate, scaleUpRate, scaleUpRate) }, { easing: 'fade' });\n        let scale2 = tween().to(duration, { scale: new Vec3(toRate, toRate, toRate) }, { easing: 'fade' });\n        let func = tween().call(() => {\n            finishedCallback && finishedCallback();\n        })\n\n        let animate = tween(target)\n            .set(scale0)\n            .then(scale1)\n            .then(scale2)\n            .then(func)\n            .start();\n\n        return animate;\n    }\n\n    public static equalsArray<T>(a: T[], b: T[]): boolean {\n        return a.length === b.length &&\n            a.every((v, i) => v === b[i]);\n    }\n\n    public static shakeEffect(node, duration, strength): Tween<any> {\n        if (!node) return;\n        if (node[\"tween_shake\"]) node[\"tween_shake\"].stop(); // stop if on tween;\n\n        let backUpPos = node.getPosition();\n        let lstMoveTweens: Tween<any>[] = [];\n\n        let loopTime = Math.floor(duration / 0.01);\n        for (let i = 0; i < loopTime; i++) {\n            let rand_x = backUpPos.x + this.getRandomFloat(-strength, strength);\n            let rand_y = backUpPos.y + this.getRandomFloat(-strength, strength);\n            let moveTw = tween().to(0.01, { position: new Vec3(rand_x, rand_y, 1) });\n            lstMoveTweens.push(moveTw);\n        }\n\n        let twShake = tween(node)\n            .sequence(...lstMoveTweens)\n            .call(() => {\n                node.setPosition(backUpPos);\n                node[\"tween_shake\"] = null;\n            })\n            .start();\n        node[\"tween_shake\"] = twShake;\n        return twShake;\n    }\n\n    public static getRandomFloat(min, max) {\n        return Math.random() * (max - min) + min;\n    };\n\n    public static shuffleArray<T>(a: T[]): T[] {\n        for (let i = a.length - 1; i >= 0; i--) {\n            const randomIndex = Math.floor(Math.random() * (i + 1));\n            const itemIndex = a[randomIndex];\n            a[randomIndex] = a[i];\n            a[i] = itemIndex;\n        }\n        return a;\n    }\n\n    public static clearArray<T>(a: T[]): T[] {\n        return a.splice(0, a.length);\n    }\n\n    public static cloneArray<T>(a: T[]): T[] {\n        return [...a];\n    }\n}"]}