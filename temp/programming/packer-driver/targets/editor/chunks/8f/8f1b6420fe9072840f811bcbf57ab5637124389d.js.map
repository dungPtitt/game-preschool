{"version":3,"sources":["file:///D:/game/FrameworkCocos/assets/vd-framework/common/VDGameLoop.ts"],"names":["VDGameLoop","_listFuncLoop","Map","_intervalId","instance","_instance","update","_this","isRunning","forEach","value","key","funcName","apply","caller","TIME_LOOP","removeFunc","addFunc","data","set","start","setInterval","stop","clearInterval","cleanUp","delete","clear","func","get"],"mappings":";;;iBACqBA,U;;;;;;;;;;;;;yBAAAA,U,GAAN,MAAMA,UAAN,CAAiB;AAAA;AAAA,eAGpBC,aAHoB,GAGc,IAAIC,GAAJ,EAHd;AAAA,eAIpBC,WAJoB,GAIE,CAAC,CAJH;AAAA;;AAOF,mBAARC,QAAQ,GAAe;AACrC,iBAAOJ,UAAU,CAACK,SAAlB;AACH;;AAEDC,QAAAA,MAAM,GAAG;AACL,cAAIC,KAAK,GAAGP,UAAU,CAACK,SAAvB;;AACA,cAAIE,KAAK,CAACC,SAAN,EAAJ,EAAuB;AACnBD,YAAAA,KAAK,CAACN,aAAN,CAAoBQ,OAApB,CAA4B,CAACC,KAAD,EAAaC,GAAb,KAA6B;AACrD,kBAAID,KAAJ,EAAW;AACPA,gBAAAA,KAAK,CAACE,QAAN,CAAeC,KAAf,CAAqBH,KAAK,CAACI,MAAN,CAAad,UAAU,CAACe,SAAxB,CAArB;AACH,eAFD,MAEO;AACHR,gBAAAA,KAAK,CAACS,UAAN,CAAiBL,GAAjB;AACH;AACJ,aAND;AAOH;AACJ;;AAEDM,QAAAA,OAAO,CAACN,GAAD,EAAcG,MAAd,EAA2BF,QAA3B,EAA0C;AAC7C,cAAIM,IAAI,GAAG;AACP,mBAAOP,GADA;AAEP,sBAAUG,MAFH;AAGP,wBAAYF;AAHL,WAAX;;AAKA,eAAKX,aAAL,CAAmBkB,GAAnB,CAAuBR,GAAvB,EAA4BO,IAA5B;AACH;;AAEDV,QAAAA,SAAS,GAAG;AACR,iBAAO,KAAKL,WAAL,GAAmB,CAA1B;AACH;;AAEDiB,QAAAA,KAAK,GAAG;AACJ,cAAI,KAAKjB,WAAL,GAAmB,CAAvB,EAA0B;AACtB,iBAAKG,MAAL;AACA,iBAAKH,WAAL,GAAmBkB,WAAW,CAAC,KAAKf,MAAN,EAAcN,UAAU,CAACe,SAAX,GAAuB,IAArC,CAA9B;AACH;AACJ;;AAEDO,QAAAA,IAAI,GAAG;AACH,cAAI,KAAKnB,WAAL,GAAmB,CAAvB,EAA0B;AACtBoB,YAAAA,aAAa,CAAC,KAAKpB,WAAN,CAAb;AACA,iBAAKA,WAAL,GAAmB,CAAC,CAApB;AACH;AACJ;;AAEDqB,QAAAA,OAAO,GAAG;AACN,eAAK,IAAIb,GAAT,IAAgB,KAAKV,aAArB,EAAoC;AAChC,iBAAKA,aAAL,CAAmBkB,GAAnB,CAAuBR,GAAvB,EAA4B,IAA5B;;AACA,iBAAKV,aAAL,CAAmBwB,MAAnB,CAA0Bd,GAA1B;AACH;;AACD,eAAKV,aAAL,CAAmByB,KAAnB;AACH;;AAEDV,QAAAA,UAAU,CAACL,GAAD,EAAc;AACpB,cAAIgB,IAAI,GAAG,KAAK1B,aAAL,CAAmB2B,GAAnB,CAAuBjB,GAAvB,CAAX;;AACA,cAAIgB,IAAJ,EAAU;AACN,iBAAK1B,aAAL,CAAmBwB,MAAnB,CAA0Bd,GAA1B;;AACA,mBAAO,IAAP;AACH;;AACD,iBAAO,KAAP;AACH;;AAlE2B,O;;AAAXX,MAAAA,U,CACHe,S,GAAY,G;AADTf,MAAAA,U,CAMFK,S,GAAwB,IAAIL,UAAJ,E","sourcesContent":["\nexport default class VDGameLoop {\n    public static TIME_LOOP = 0.1; // in second\n\n    private _listFuncLoop: Map<string, any> = new Map();\n    private _intervalId: number = -1;\n\n    private static _instance: VDGameLoop = new VDGameLoop();\n    public static get instance(): VDGameLoop {\n        return VDGameLoop._instance;\n    }\n\n    update() {\n        var _this = VDGameLoop._instance;\n        if (_this.isRunning()) {\n            _this._listFuncLoop.forEach((value: any, key: string) => {\n                if (value) {\n                    value.funcName.apply(value.caller[VDGameLoop.TIME_LOOP]);\n                } else {\n                    _this.removeFunc(key);\n                }\n            });\n        }\n    }\n\n    addFunc(key: string, caller: any, funcName: any) {\n        var data = {\n            \"key\": key,\n            \"caller\": caller,\n            \"funcName\": funcName\n        };\n        this._listFuncLoop.set(key, data);\n    }\n\n    isRunning() {\n        return this._intervalId > 0;\n    }\n\n    start() {\n        if (this._intervalId < 0) {\n            this.update();\n            this._intervalId = setInterval(this.update, VDGameLoop.TIME_LOOP * 1000);\n        }\n    }\n\n    stop() {\n        if (this._intervalId > 0) {\n            clearInterval(this._intervalId);\n            this._intervalId = -1;\n        }\n    }\n\n    cleanUp() {\n        for (var key in this._listFuncLoop) {\n            this._listFuncLoop.set(key, null);\n            this._listFuncLoop.delete(key);\n        }\n        this._listFuncLoop.clear();\n    }\n\n    removeFunc(key: string) {\n        var func = this._listFuncLoop.get(key);\n        if (func) {\n            this._listFuncLoop.delete(key);\n            return true;\n        }\n        return false;\n    }\n\n}"]}